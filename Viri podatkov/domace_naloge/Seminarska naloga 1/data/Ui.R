library(plotly)
library(shinyWidgets)

podatki_pn <- readRDS("podatki_pn_ocisceno")
Slovenia2_df <- readRDS("Slovenia2_df")


shinyUI(
  navbarPage(title = "Prometne nesreče v Sloveniji",
             tabPanel(title = "Prometne nesreče",
                      sidebarLayout(
                        sidebarPanel(
                          dateRangeInput(inputId = "daterange", label = "Časovno obdobje:",
                                         start = "2020-01-01",
                                         end = "2020-12-31",
                                         min = "2018-01-01",
                                         max = "2020-12-31",
                                         format = "dd.mm.yyyy",
                                         weekstart = 1, 
                                         language = "sl"),
                          hr(),
                          selectInput(inputId = "xaxis", label = "X os:",
                                      choices = sort(c("Klasifikacija nesreče" = "KlasifikacijaNesrece",
                                                       "Datum prometne nesreče" = "DatumPN",
                                                       "Ura prometne nesreče" = "UraPN",
                                                       "Vrsta ceste" = "VrstaCesteNaselja",
                                                       "Opis kraja" = "OpisKraja",
                                                       "Tip nesreče" = "TipNesrece",
                                                       "Vremenske okoliščine" = "VremenskeOkoliscine",
                                                       "Spol povzročitelja" = "Spol",
                                                       "Vzrok nesreče" = "VzrokNesrece",
                                                       "Mesec" = "Mesec",
                                                       "Dan v tednu" = "DanvTednu",
                                                       "Leto" = "Leto")),
                                      selected = "DatumPN"),
                          hr(),
                          selectInput(inputId = "fill", label = "Dodatna spremenljivka:",
                                      choices = sort(c("Klasifikacija nesreče" = "KlasifikacijaNesrece",
                                                       "Vrsta ceste" = "VrstaCesteNaselja",
                                                       "Opis kraja" = "OpisKraja",
                                                       "Tip nesreče" = "TipNesrece",
                                                       "Vremenske okoliščine" = "VremenskeOkoliscine",
                                                       "Spol povzročitelja" = "Spol",
                                                       "Vzrok nesreče" = "VzrokNesrece",
                                                       "Mesec" = "Mesec",
                                                       "Dan v tednu" = "DanvTednu",
                                                       "Nič" = "None",
                                                       "Leto" = "Leto")),
                                      selected = "None"),
                          checkboxInput(inputId = "relativno", label = "Relativno"),
                          width = 2
                        ),
                        mainPanel(
                          plotlyOutput(outputId = "hist"),
                          width = 10
                        )
                      )),
             tabPanel("Povzročitelji nesreč",
                      sidebarLayout(
                        sidebarPanel(
                          dateRangeInput(inputId = "daterange_druga", label = "Časovno obdobje:",
                                         start = "2020-01-01",
                                         end = "2020-12-31",
                                         min = "2018-01-01",
                                         max = "2020-12-31",
                                         format = "dd.mm.yyyy",
                                         weekstart = 1, 
                                         language = "sl"),
                          checkboxGroupInput(inputId = "spol", label = "Spol povzročitelja nesreče:", 
                                             choices = c("Moški" = "MOŠKI",
                                                         "Ženski" = "ŽENSKI"),
                                             selected = c("MOŠKI", "ŽENSKI")),
                          radioButtons(inputId = "starost_staz", label = "Prikaz spremenljivke:",
                                       choices = c("Starost" = "Starost",
                                                   "Vozniški staž" = "VozniskiStazVLetih")),
                          selectInput(input = "neki", label = "Prikaz spremenljivke:",
                                      choices = sort(c("Klasifikacija nesreče" = "KlasifikacijaNesrece",
                                                       "Vrsta ceste" = "VrstaCesteNaselja",
                                                       "Opis kraja" = "OpisKraja",
                                                       "Tip nesreče" = "TipNesrece",
                                                       "Vremenske okoliščine" = "VremenskeOkoliscine",
                                                       "Spol povzročitelja" = "Spol",
                                                       "Vzrok nesreče" = "VzrokNesrece",
                                                       "Mesec" = "Mesec",
                                                       "Dan v tednu" = "DanvTednu",
                                                       "Leto" = "Leto"))),
                          width = 3
                        ),
                        mainPanel(
                          plotlyOutput(outputId = "bar"),
                          width = 9
                        )
                      )),
             tabPanel("Zemljevid",
                      sidebarLayout(
                        sidebarPanel(
                          dateRangeInput(inputId = "zemljevid_daterange", label = "Časovno obdobje",
                                         start = "2020-01-01",
                                         end = "2020-12-31",
                                         min = "2018-01-01",
                                         max = "2020-12-31",
                                         format = "dd.mm.yyyy",
                                         separator = " to ",
                                         weekstart = 1, 
                                         language = "sl"),
                          selectInput(inputId = "zemljevid_id", label = "Izberite:",
                                      choices = sort(c("Vozniški staž povzročitelja v letih" = "vozniski_staz",
                                                       "Starost povzročitelja v letih" = "starost",
                                                       "Vrednost alkotesta povzročitelja" = "vrednost_alkotesta",
                                                       "Število nesreč" = "st_nesrec",
                                                       " " = "prazno")),
                                      selected = "prazno")),
                        mainPanel(
                          plotOutput(outputId = "zemljevid")
                        )
                      )),
             tabPanel("Tabela nesreč",
                      sidebarLayout(
                        sidebarPanel(
                          dateRangeInput(inputId = "daterange_tabela", label = "Časovno obdobje",
                                         start = "2020-01-01",
                                         end = "2020-12-31",
                                         min = "2018-01-01",
                                         max = "2020-12-31",
                                         format = "dd.mm.yyyy",
                                         weekstart = 1, 
                                         language = "sl"),
                          pickerInput(inputId = "spol_tabela", label = "Spol povzročitelja nesreče:", 
                                      choices = c("Moški" = "MOŠKI",
                                                  "Ženski" = "ŽENSKI"),
                                      selected = c("MOŠKI", "ŽENSKI"),
                                      multiple = TRUE,
                                      options = list(`actions-box` = TRUE)),
                          sliderInput(inputId = "starost_tabela", label = "Starost",
                                      min = 0, max = max(podatki_pn$Starost), value = c(0, max(podatki_pn$Starost))),
                          pickerInput(inputId = "klasifikacija_tabela", label = "Klasifikacija nesreče",
                                      choices = c(unique(as.character(podatki_pn$KlasifikacijaNesrece))),
                                      multiple = TRUE,
                                      selected = c(unique(as.character(podatki_pn$KlasifikacijaNesrece))),
                                      options = list(`actions-box` = TRUE)),
                          pickerInput(inputId = "upravna_enota_tabela", label = "Upravna enota",
                                      choices = sort(c(unique(as.character(podatki_pn$UpravnaEnotaStoritve)))),
                                      multiple = TRUE,
                                      selected = c(unique(as.character(podatki_pn$UpravnaEnotaStoritve))),
                                      options = list(`actions-box` = TRUE)),
                          pickerInput(inputId = "vzrok_tabela", label = "Vzrok nesreče:",
                                      choices = c(unique(as.character(podatki_pn$VzrokNesrece))),
                                      multiple = TRUE,
                                      selected = c(unique(as.character(podatki_pn$VzrokNesrece))),
                                      options = list(`actions-box` = TRUE)),
                          pickerInput(inputId = "tip_tabela", label = "Tip nesreče",
                                      choices = c(unique(as.character(podatki_pn$TipNesrece))),
                                      multiple = TRUE,
                                      selected = c(unique(as.character(podatki_pn$TipNesrece))),
                                      options = list(`actions-box` = TRUE)),
                          pickerInput(inputId = "udelezenec_tabela", label = "Vrsta povzročitelja",
                                      choices = c(unique(as.character(podatki_pn$VrstaUdelezenca))),
                                      multiple = TRUE,
                                      selected = c(unique(as.character(podatki_pn$VrstaUdelezenca))),
                                      options = list(`actions-box` = TRUE)),
                          width = 2
                          ),
                        mainPanel(
                          div(DT::dataTableOutput("tabela"), 
                              style = "font-size:80%"),
                          width = 10
                        )
                      )),
             tabPanel("O aplikaciji",
                      column(h1("O aplikaciji"),
                               p("Namen aplikacije je interaktivna predstavitev podatkov o prometnih nesrečah in njihovih povzročiteljih za obdobje med letoma 2018 in 2020. Zajete so vse prometne nesreče, ki so se zgodile v Sloveniji in pri katerih je pri ogledu sodelovala policija. "),
                               p("Podatki so bili prodobljeni s", a(href = "https://www.policija.si/o-slovenski-policiji/statistika/prometna-varnost", "spletne strani Policije,"), "več o podatkih na", a(href = "https://www.policija.si/o-slovenski-policiji/statistika/prometna-varnost/prometna-varnost-statisticne-datoteke-navodila", "povezavi.")),
                               h2("Prometne nesreče"),
                               p("Uporabnik izbere želeno časovno obdobje (prednastavljeno je leto 2020) ter izbere, kaj se prikazuje na abscisni osi grafa. Med možnostmi so: dan v tednu, datum prometne nesreče, klasifikacija nesreče, leto nesreče, mesec nesreče, opis kraja, spol povzročitelja, tip nesreče, ura prometne nesreče, vremenske okoliščine, vrsta ceste in vzrok nesreče. V prikaz lahko uporabnik doda tudi dodatno spremenljivko ali pa spremeni prikaz v relativni prikaz. "),
                               h2("Povzročitelji nesreč"),
                               p("Uporabnik izbere želeno časovno obdobje, spol povzročitelja nesreče ter izbira med tem, ali se na abscisni osi prikaže starost ali vozniški staž. Izbrano lahko primerja glede na dan v tednu, mesec, leto, klasifikacijo nesreče, opis kraja, spol povzročitelja, tip nesreče, vremenske okoliščine, vrsto ceste ter vzrok prometne nesreče."),
                               h2("Zemljevid"),
                               p("Uporabnik izbere časovno obdobje ter spremenljivko, ki se prikaže na zemljevidu upravnih enot. Možne spremenljivke so: število nesreč, povprečna starost povzročitelja v letih, povprečen vozniški staž povzročitelja v letih ter povprečna vrednost alkotesta povzročitelja."),
                               h2("Tabela nesreč"),
                               p("V tabeli so navedene vse prometne nesreče, ki ustrezajo kriterijem, ki jih izbere uporabnik. Uporabnik lahko določi časovno obdobje, spol povzročitelja, starost povzročitelja, klasifikacijo nesreče, upravno enoto (kjer se je prometna nesreča zgodila), vzrok nesreče in tip nesreče. Dodatna informacija, ki jo uporabnik lahko razbere iz tabele, je cesta/naselje oz. odsek/ulica prometne nesreče. Po podatkih v tabeli lahko uporabnik išče tudi s funkcijo »search«."),
                               hr(),
                               p("Avtorici aplikacije: Ana Tomac in Maja Urankar"),
                               width = 6, offset = 3,
                             style = "text-align:justify")
                      ),
             selected = "O aplikaciji",
             inverse = TRUE,
             windowTitle = "Prometne nesreče v Sloveniji")
)