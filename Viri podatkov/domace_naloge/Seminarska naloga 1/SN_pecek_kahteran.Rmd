---
title: "Seminarska naloga"
subtitle: "Viri podatkov"
author: "Urh Peček in Alen Kahteran"
date: "7. 5. 2020"
output:
    html_document:
        toc: true
        theme: united
params:
    printcode: no
printresults: hide
editor_options:
    chunk_output_type: console
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo=params$printcode, results=params$printresults, warning=FALSE, message=FALSE)

library(dplyr)
library(tidyr)
library(ggplot2)
library(gridExtra)
library(ggfortify)
library(ggthemes)

```


V tej nalogi bo predstavljeno nekaj pogledov o raku na debelem črevu, rektumu in rektosigmoidni zvezi. Podatki so pridobljeni na spletni strani SLORA (Slovenija in rak - Register raka republike Slovenije).

Pri večini grafov, kjer je le lahko, je prikazana groba stopnja saj je bolj primerljiva med starostnimi skupinami, upravnimi enotami, spolu, itd. saj so te mere tako normalizirane. Groba stopnja je podatek o številu novih primerov bolezni ali številu umrlih, preračunana na 100.000 oseb opazovane populacije.

# Incidenca

Incidenca pomeni absolutno število vseh na novo ugotovljenih primerov neke bolezni (v našem primeru raka) v točno določeni populaciji v enem koledarskem letu. Ker incidenca ne šteje bolnikov, pač pa primere bolezni, lahko posamezna oseba, če v istem letu zboli za različnimi rakavimi boleznimi, prispeva v incidenco več primerov bolezni. V incidenco raka ne štejemo novih primarnih rakov parnega organa iste lokacije, če je bila histološka vrsta obeh rakov, npr. leve in desne dojke, enaka. Prav tako v incidenco ne štejemo novega pojava raka iste histološke vrste na istem organu, npr. multiple lezije v debelem črevesu.


## Osnovni pogled

<br/><br/>

```{r, echo=FALSE, eval=TRUE, results="markup", fig.align="center"}
data <- data.frame("Leto"=1961:2017,
                   "inc_stopnja"=c(11.1, 12, 12.1, 12.5, 15.9, 15.3, 16.8, 18.2, 16.9, 18.2, 17.7, 20.6, 19.6, 20.5, 23.7, 21.7, 23.7, 25.5, 24.7, 25.2, 28, 26.1, 28.8, 28.5, 28.8, 29.5, 32.4, 33.5, 33, 35.9, 37.6, 41.4, 43.2, 44.4, 44.4, 46.1, 50.2, 53.4, 51.1, 55.1, 56.7, 60.9, 61.1, 65.7, 61.8, 65.3, 70.4, 72.3, 77.6, 84.5, 80, 75.1, 67.3, 69.1, 66.3, 71.2, 64.3))


a <- ggplot(data, aes(x=Leto, y=inc_stopnja)) +
    geom_line(, size=1) +
    labs(x="Leto",
         y="Groba incidenčna stopnja na 100.000",
         title="Groba incidenčna stopnja v Sloveniji za izbrane rake") +
    theme_minimal() +
    ylim(c(0, 85))

```

```{r, echo=FALSE, eval=TRUE, results="markup", fig.align="center", fig.width=14, fig.height=7}
data <- data.frame("starostna_skupina"=c("0-04",
"05-09",
"10-14",
"15-19",
"20-24",
"25-29",
"30-34",
"35-39",
"40-44",
"45-49",
"50-54",
"55-59",
"60-64",
"65-69",
"70-74",
"75-79",
"80+"),
                   "inc_stopnja"=c(0,
0,
0,
1.1,
0,
1.7,
2.9,
7.7,
17.6,
25.4,
54.8,
64.6,
111.5,
147,
225.4,
245.8,
309.1))


b <- ggplot(data, aes(x=starostna_skupina, y=inc_stopnja)) +
    geom_bar(stat="identity") +
    labs(x="Starostna skupina",
         y="Groba incidenčna stopnja na 100.000",
         title="Groba incidenčna stopnja v Sloveniji za izbrane rake",
         subtitle="Za leto 2017 po starostnih skupinah") +
    theme_minimal()

grid.arrange(a, b, ncol=2)
```

```{r, echo=FALSE, eval=TRUE, results="markup", fig.align="center"}


# c("Debelo črevo (C18)", "rektum (C20)", "rektosigmoidna zveza (C19)")
# 
data <- data.frame("Leto"=1961:2017,
                   "debelo"=c(5, 5, 4.6, 5.4, 6.8, 5.7, 6.3, 7.6, 5.8, 6.9, 7.2, 8.7, 8.1, 8.5, 9.6, 10.4, 9.5, 11.3, 10.5, 10.4, 12.2, 12.4, 12.3, 12.6, 12.9, 12.6, 15.1, 16.1, 16.5, 16.5, 18.3, 20.8, 21.4, 22.1, 22.1, 25.9, 26.1, 29.2, 28.4, 29.9, 31.7, 33.7, 33.3, 36.3, 35.2, 35.7, 39.5, 41.1, 44.8, 48.9, 47.4, 45.2, 38.5, 40.1, 41.8, 44, 38.1),
                   "rektosig"=c(0.1, 0.3, 0.1, 0.1, 0.5, 0.6, 1.3, 1, 0.8, 0.9, 1, 0.9, 1, 1.3, 2.3, 1.7, 2.7, 2, 2.6, 3.2, 2.3, 2.5, 3.4, 3.2, 2.7, 3.2, 3.1, 3.3, 3.2, 4.3, 3.9, 3.8, 3.8, 5.8, 5.1, 3.8, 4.5, 5.2, 5.4, 4.4, 5.5, 5.1, 5, 6.1, 5.7, 6.7, 7.2, 6.4, 7.1, 8.7, 6.9, 6.2, 6.1, 7.3, 5.5, 5, 5.8),
                   "rektum"=c(6, 6.7, 7.4, 7, 8.7, 8.9, 9.3, 9.6, 10.4, 10.4, 9.4, 11.1, 10.4, 10.8, 11.8, 9.6, 11.5, 12.2, 11.6, 11.6, 13.5, 11.2, 13.1, 12.7, 13.1, 13.6, 14.3, 14.1, 13.3, 15.2, 15.4, 16.8, 18, 16.5, 17.1, 16.4, 19.6, 19, 17.3, 20.8, 19.5, 22.1, 22.8, 23.4, 20.8, 23, 23.6, 24.8, 25.7, 26.9, 25.7, 23.7, 22.7, 21.7, 19, 22.1, 20.4))


ggplot(data %>% pivot_longer(cols = c("debelo", "rektosig", "rektum"), names_to="Rak", values_to="inc_stopnja"), aes(x=Leto, y=inc_stopnja, color=Rak)) +
    geom_line(stat="identity", size=1) +
    labs(x="Tip raka",
         y="Groba incidenčna stopnja na 100.000",
         title="Groba incidenčna stopnja v Sloveniji za izbrane rake v času") +
    theme_minimal() + 
    scale_color_manual(labels = c("Debelo črevo (C18)", "rektosigmoidna zveza (C19)", "rektum (C20)"), values=c("red","green","blue"))

```

```{r, echo=FALSE, eval=TRUE, results="markup", fig.align="center"}
data <- data.frame("Leto"=1961:2017,
                   "Moški"=c(12.1, 11.1, 12.4, 12.8, 14, 13.6, 19.1, 18.3, 17.3, 19.1, 17.3, 22, 20.5, 17.7, 23.1, 22, 22.3, 25.9, 24.8, 24.2, 29.2, 25.3, 27.4, 29.5, 28.1, 30, 34.1, 35.6, 35.8, 38.6, 40.1, 44.9, 45.3, 48.2, 48.7, 50.3, 53.7, 61.3, 59.7, 61.8, 64.9, 70.5, 70.8, 74.8, 70.8, 76.5, 80.3, 83.4, 93.1, 101.2, 98.2, 91.8, 80.4, 84, 77.4, 84.8, 77.4),
                   "Ženske"=c(10.2, 12.9, 11.8, 12.2, 17.7, 16.8, 14.6, 18.1, 16.5, 17.4, 18, 19.3, 18.7, 23.1, 24.2, 21.5, 25.1, 25.2, 24.6, 26.2, 26.9, 26.8, 30, 27.6, 29.4, 29, 30.9, 31.5, 30.3, 33.4, 35.2, 38.1, 41.3, 40.9, 40.3, 42.1, 47, 45.9, 42.9, 48.7, 48.8, 51.7, 51.8, 57.1, 53.2, 54.6, 60.7, 61.6, 62.3, 68.1, 62.2, 58.8, 54.4, 54.5, 55.4, 57.8, 51.3))


c <- ggplot(data %>% pivot_longer(cols = c("Moški", "Ženske"), names_to="Spol", values_to="inc_stopnja"), aes(x=Leto, y=inc_stopnja)) +
    geom_line(aes(color = Spol), size=1) + 
    labs(x="Leto",
         y="Groba incidenčna stopnja na 100.000",
         title="Groba incidenčna stopnja v Sloveniji za izbrane rake",
         subtitle="Glede na spol") +
    theme_minimal() +
    scale_color_manual(name="Spol", 
                       labels = c("Moški", "Ženske"), 
                       values = c("Moški"="skyblue", "Ženske"="tomato")) +
    ylim(c(0,110))

```

```{r, echo=FALSE, eval=TRUE, results="markup", fig.align="center", fig.height=8}

data <- data.frame("starostna_skupina"=c("0-04",
"05-09",
"10-14",
"15-19",
"20-24",
"25-29",
"30-34",
"35-39",
"40-44",
"45-49",
"50-54",
"55-59",
"60-64",
"65-69",
"70-74",
"75-79",
"80+"),
                   "Moški"=c(0,
0,
0,
0,
0,
3.2,
0,
6.1,
21.2,
21.3,
59.8,
90.9,
148.1,
208.5,
304.7,
336.9,
511.9),
                   "Ženske"=c(0,
0,
0,
2.2,
0,
0,
6,
9.5,
13.6,
29.7,
49.7,
37.9,
74.8,
89.3,
160.4,
179.7,
213.6))


brks <- seq(-600, 600, 100)
lbls = c(seq(600, 0, -100), seq(100, 600, 100))

ggplot(data %>% pivot_longer(cols = c("Moški", "Ženske"), names_to="Spol", values_to="inc_stopnja") %>%
    mutate(multiplier = if_else(Spol == "Moški", -1, 1, 0)) %>%
    mutate(inc_stopnja = inc_stopnja*multiplier), 
    aes(x =inc_stopnja, y = starostna_skupina, fill = Spol)) +   # Fill column
    geom_bar(stat = "identity", width = .6) +   # draw the bars
    scale_x_continuous(breaks = brks,   # Breaks
                       labels = lbls) + # Labels
    scale_fill_manual(name="Spol", 
                       labels = c("Moški", "Ženske"), 
                       values = c("Moški"="skyblue", "Ženske"="tomato"))+
    labs(title="Groba incidenčna stopnja v Sloveniji po spolu",
         subtitle="Za leto 2017",
         x="Groba incidenčna stopnja na 100.000",
         y="Starostna skupina") +
    theme_minimal()



```

<br/><br/>

Starostno standardizirana stopnja je teoretična stopnja, pri kateri predpostavimo, da je starostna struktura opazovane populacije taka kot v standardni populaciji – pove nam torej kakšna bi bila groba stopnja v opazovani populaciji, če bi bila starostna struktura te populacije enaka kot je v standardni populaciji.

<br/><br/>

```{r, echo=FALSE, eval=TRUE, results="markup", fig.align="center", fig.width=14, fig.height=7}
data <- data.frame("Leto"=1961:2017,
                   "Moški"=c(19.6, 17.9, 20.9, 20.9, 22.9, 22.9, 29.6, 28.2, 29.3, 29.8, 26.9, 35.8, 32, 29.4, 39.4, 34.2, 34.7, 40, 38.7, 37.4, 46, 39.5, 42.4, 46.9, 44.3, 48.7, 54.2, 55.4, 55.9, 58.7, 61.2, 67.9, 67.6, 69.6, 69.4, 69.6, 73, 81.2, 77.9, 79.6, 80.2, 86.1, 86.1, 86.4, 79.9, 85.8, 88.2, 89.3, 97.1, 101.7, 97.5, 89.5, 76.4, 78.2, 71.2, 76.6, 67.3),
                   "Ženske"=c(12.4, 16, 14.3, 14.6, 21.1, 19.9, 17.5, 21.7, 19.8, 20.2, 21.4, 23.6, 22.9, 29.1, 28.9, 24.6, 28.2, 28, 27, 29.6, 30.3, 30, 34.3, 30.8, 33.2, 31.9, 33.5, 33.6, 32, 35.5, 37, 39.4, 41.4, 40.8, 40, 40.1, 44.2, 42.8, 39, 43.8, 42.7, 43.9, 44, 47.4, 42.4, 44, 47.7, 48.3, 48, 52.6, 48.5, 44.6, 39.6, 38.8, 38.6, 41.4, 36.3))


d <- ggplot(data %>% pivot_longer(cols = c("Moški", "Ženske"), names_to="Spol", values_to="inc_stopnja"), aes(x=Leto, y=inc_stopnja)) +
    geom_line(aes(color = Spol), size=1) + 
    labs(x="Leto",
         y="Starostno standardizirana incidenčna stopnja na 100.000",
         title="Starostno standardizirana incidenčna stopnja v Sloveniji za izbrane rake",
         subtitle="Slovenski standard") +
    theme_minimal() +
    scale_color_manual(name="Spol", 
                       labels = c("Moški", "Ženske"), 
                       values = c("Moški"="skyblue", "Ženske"="tomato")) +
    ylim(c(0,110))

grid.arrange(c, d, ncol=2)

```

<br/><br/>

## Dodatna vizualizacija

```{r, echo=FALSE, eval=TRUE, results="markup", fig.align="center"}

data <- data.frame("Leto"=1961:2017,
                   "0_04"=c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
                   "05_09"=c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0),
                   "10_14"=c(0, 0, 0, 0, 0, 0, 0.7, 0, 0, 0, 0, 0.7, 0, 0, 0, 0, 0, 0, 0.7, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.8, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1.1, 0, 1.1, 2.2, 0, 1.1, 0),
                   "15_19"=c(0.7, 0, 0.7, 0, 0, 0.7, 1.3, 0.7, 0, 0, 0.7, 0, 0, 0, 0, 0, 0, 0, 0, 0.7, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.7, 0, 0, 0.7, 0, 0.7, 0, 0, 0, 0.8, 0, 0, 0, 0, 0, 0, 0, 1, 2, 1, 1, 1.1, 1.1, 1.1),
                   "20_24"=c(0, 0, 2, 0, 0.7, 0.7, 1.4, 1.4, 0, 0.7, 1.4, 2.7, 2, 0, 0.7, 0, 2, 0, 1.3, 0, 0, 0.7, 2, 0, 0.7, 0, 0.7, 0, 0, 0, 0, 0.7, 0, 0.7, 0, 0, 0, 0, 0, 0.7, 1.3, 1.3, 0, 1.4, 0.7, 0, 0, 0, 0.7, 0.8, 0, 0.8, 1.8, 0, 0, 1, 0),
                   "25_29"=c(2.5, 0.8, 0.8, 0.8, 0.8, 1.7, 2.5, 0.8, 0.8, 1.7, 0.8, 0, 2.5, 1.7, 2.5, 1.2, 1.8, 1.2, 1.2, 0, 1.8, 1.8, 1.8, 0.6, 0.6, 0, 1.3, 2.5, 3.2, 1.3, 3.2, 0.6, 2, 0.7, 2.7, 0.7, 0.7, 0, 2.8, 2.8, 0, 1.3, 1.3, 0.7, 2, 1.3, 1.9, 1.3, 1.3, 0.7, 0, 1.4, 0.7, 0.7, 1.5, 0.8, 1.7),
                   "30_34"=c(2.4, 1.6, 4.8, 3.2, 3.2, 4.8, 4, 1.6, 3.2, 4.8, 2.4, 1.6, 4, 3.2, 3.2, 4, 0.7, 2, 4, 2.7, 6, 4, 1.3, 2.7, 3.4, 3.5, 4.7, 1.8, 3.7, 3.7, 1.3, 4.5, 2.6, 0.7, 5.2, 1.3, 1.9, 1.3, 4.6, 5.4, 3.4, 0.7, 0.7, 2.8, 1.4, 2, 3.3, 1.3, 6.4, 1.3, 2.5, 2.5, 1.9, 4, 2.7, 4.2, 2.9),
                   "35_39"=c(2.3, 2.3, 1.6, 3.9, 0, 3.9, 4.7, 7.8, 2.3, 2.3, 3.1, 1.6, 6.2, 2.3, 7, 5.9, 6.7, 6.7, 5.9, 2.5, 6.7, 6.7, 9.3, 9.3, 4.2, 3.2, 5.7, 8.6, 8.4, 7.8, 5.4, 3, 8, 10.6, 3.2, 5.8, 7.7, 6.5, 5.2, 7.7, 5.1, 5.8, 5.8, 8.5, 3.3, 6.8, 10.3, 9.6, 8.8, 6, 9.8, 5.2, 7.8, 6.4, 7.6, 5.7, 7.7),
                   "40_44"=c(0.8, 4.8, 4, 9.6, 12.8, 4, 9.6, 9.6, 7.2, 8.8, 10.4, 10.4, 7.2, 8, 16, 10.6, 13.9, 8.2, 12.2, 9.8, 12.2, 9.8, 9.8, 12.2, 13.9, 11.6, 13.8, 11.2, 9.9, 12.3, 11.3, 13.1, 9.5, 15.5, 13, 10.5, 16, 13.7, 12.6, 10.2, 12.2, 12.3, 10.3, 10.3, 15.5, 10.2, 9.5, 17.3, 13.5, 13.1, 17.5, 25.9, 13.7, 11.6, 12.1, 15.8, 17.6),
                   "45_49"=c(19, 7.6, 11.4, 7.6, 9.5, 10.4, 8.5, 14.2, 19.9, 13.3, 17.1, 18, 15.2, 19, 15.2, 12.2, 14.7, 22, 22.8, 21.2, 18.7, 17.9, 19.5, 17.1, 20.4, 17.9, 21, 22.3, 18.6, 24.8, 26.7, 20.3, 31.6, 26, 24.7, 25.4, 27.4, 23.8, 24.4, 30.2, 23.2, 31, 27, 27.2, 20.5, 29.7, 24, 27.8, 21.2, 23, 35, 23.5, 30.8, 22.7, 25.1, 27.1, 25.4),
                   "50_54"=c(32.9, 37.6, 37.6, 25.1, 39.2, 31.3, 28.2, 31.3, 29.8, 17.2, 18.8, 34.5, 28.2, 59.5, 43.9, 25.5, 29.7, 27.2, 36.5, 27.2, 34.8, 37.4, 39.1, 31.4, 37.4, 33.2, 45.9, 45.7, 47.1, 33.3, 45.2, 50, 50.2, 49.6, 61.9, 51.4, 46.9, 69.2, 57, 45.8, 60, 53.3, 39, 56.3, 46.9, 51.1, 53, 58.1, 58.8, 88, 94, 70.9, 54.3, 63.4, 50.1, 52.4, 54.8),
                   "55_59"=c(20.1, 41.4, 24.9, 34.3, 36.7, 45, 35.5, 49.7, 41.4, 46.2, 42.6, 32, 28.4, 22.5, 34.3, 37, 34.9, 48.3, 38, 36, 41.1, 48.3, 53.4, 59.6, 58.6, 55.4, 66.6, 76.1, 47.3, 71, 70.6, 78.9, 98.1, 75.1, 78.3, 75.3, 96, 87.7, 90, 100.2, 85.2, 76.7, 98, 96.2, 91.5, 97.8, 93.4, 93.2, 112, 148.2, 111.6, 87.1, 79.5, 72.5, 66.6, 80.5, 64.6),
                   "60_64"=c(41.7, 37.1, 41.7, 33.6, 57.9, 44, 52.1, 60.2, 45.2, 59, 57.9, 75.3, 74.1, 67.2, 74.1, 100.3, 80.9, 70.4, 56.3, 84.4, 114.4, 105.6, 126.7, 119.6, 130.2, 78.1, 85.1, 89.3, 106.6, 116.5, 116.4, 120.8, 112.3, 133.5, 128.1, 123.5, 139, 171.1, 123.9, 141.4, 144.5, 146.3, 143.9, 157, 138.2, 147.6, 162.8, 149.1, 167, 212.7, 171.9, 165.4, 141.4, 140.2, 123, 127.4, 111.5),
                   "65_69"=c(36.9, 42.6, 45.4, 59.6, 72.4, 72.4, 76.7, 88, 69.6, 93.7, 76.7, 79.5, 85.2, 86.6, 112.2, 119.4, 119.4, 119.4, 110.8, 129.3, 126.5, 88.1, 102.3, 99.5, 90.9, 135.1, 138.2, 141.9, 117.4, 112.5, 159.7, 164.2, 153.1, 184.4, 164.2, 187.6, 176.9, 199, 176.8, 199, 216.2, 250.3, 221.3, 248.9, 213.9, 201.6, 214, 242.3, 302.3, 290.9, 269, 209.3, 175.3, 171, 153, 164.1, 147),
                   "70_74"=c(63.9, 60, 52.2, 56.1, 69.7, 77.4, 110.3, 81.3, 94.8, 125.8, 102.6, 135.5, 120, 120, 125.8, 110.3, 140.2, 149.7, 159.1, 144.9, 154.4, 152.8, 178, 171.7, 174.9, 189.1, 177.1, 166.7, 179.6, 208.4, 216.8, 226.7, 220.6, 202.5, 199, 204.2, 242.1, 217.4, 255.9, 229.7, 259.6, 243.8, 275.8, 275.3, 249.2, 265.9, 330.8, 293.5, 268.6, 287.7, 296.5, 270.8, 224, 244.7, 289.8, 326.9, 225.4),
                   "75_79"=c(49.1, 70.1, 108.7, 87.7, 101.7, 87.7, 91.2, 105.2, 129.7, 108.7, 115.7, 154.3, 147.3, 185.8, 206.9, 138.2, 150.1, 212.1, 152.5, 212.1, 166.8, 169.2, 174, 214.5, 205, 197.3, 233.1, 236.1, 229.5, 252.8, 207.1, 296, 248, 299.7, 282.5, 259.3, 275.7, 295.2, 254.5, 280.6, 280.5, 297.1, 320.9, 326.7, 328.5, 345.1, 309.9, 348.4, 364.3, 352, 324.7, 365.1, 296.3, 318.9, 262.5, 275.4, 245.8),
                   "80+"=c(60.6, 69.3, 34.6, 69.3, 90.9, 90.9, 86.6, 99.6, 112.6, 64.9, 108.2, 134.2, 103.9, 103.9, 138.5, 85.3, 124.1, 118.9, 131.9, 113.8, 178.4, 155.1, 157.7, 144.8, 139.6, 214.3, 196, 205.2, 237.7, 253.5, 245.5, 246.4, 298.7, 254.9, 271.2, 331, 311.9, 304.1, 307, 355, 313.2, 380.2, 337.9, 325, 333.6, 332.5, 366.9, 343.8, 344.3, 322, 296, 313.1, 325, 321.8, 313.1, 302.3, 309.1))



ggplot(data %>% pivot_longer(cols = c("X0_04",
"X05_09",
"X10_14",
"X15_19",
"X20_24",
"X25_29",
"X30_34",
"X35_39",
"X40_44",
"X45_49",
"X50_54",
"X55_59",
"X60_64",
"X65_69",
"X70_74",
"X75_79",
"X80."), names_to="starostna_skupina", values_to="inc_stopnja"), aes(x=Leto, y=starostna_skupina, fill=inc_stopnja)) +
    geom_tile() +
    theme_minimal() +
    scale_fill_gradient(low = "white", high = "black",
                           limits=c(0,600)) +
    scale_y_discrete(labels=c("X0_04"= "0-04",
"X05_09"="05-09",
"X10_14"="10-14",
"X15_19"="15-19",
"X20_24"="20-24",
"X25_29"="25-29",
"X30_34"="30-34",
"X35_39"="35-39",
"X40_44"="40-44",
"X45_49"="45-49",
"X50_54"="50-54",
"X55_59"="55-59",
"X60_64"="60-64",
"X65_69"="65-69",
"X70_74"="70-74",
"X75_79"="75-79",
"X80."="80+")) +
    labs(y="Starostna skupina",
         fill="Groba incidenčna\nstopnja",
         title="Groba incidenčna stopnja po starostnih skupinah v času")+
    theme(panel.grid.major.x = element_blank(),
          panel.grid.major.y = element_blank())
```


<br/><br/>

```{r, echo=FALSE, eval=TRUE, results="markup", fig.align="center"}

data <- data.frame("Leto"=1961:2017,
                   "0_04"=c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
                   "05_09"=c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0),
                   "10_14"=c(0, 0, 0, 0, 0, 0, 1.4, 0, 0, 0, 0, 1.4, 0, 0, 0, 0, 0, 0, 1.4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 4.3, 0, 0, 0),
                   "15_19"=c(1.3, 0, 1.3, 0, 0, 0, 2.5, 0, 0, 0, 1.3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1.3, 0, 0, 1.3, 0, 1.4, 0, 0, 0, 1.5, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 2, 2, 0, 0),
                   "20_24"=c(0, 0, 1.3, 0, 0, 0, 1.3, 2.6, 0, 0, 2.6, 3.9, 1.3, 0, 0, 0, 2.7, 0, 2.7, 0, 0, 1.3, 1.3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1.3, 0, 1.3, 0, 2.7, 0, 0, 0, 0, 0, 0, 0, 1.6, 1.7, 0, 0, 0, 0),
                   "25_29"=c(4.8, 1.6, 0, 1.6, 1.6, 1.6, 3.2, 1.6, 0, 1.6, 1.6, 0, 3.2, 1.6, 1.6, 2.4, 3.6, 1.2, 1.2, 0, 3.6, 1.2, 2.4, 0, 1.2, 0, 0, 0, 3.9, 0, 3.8, 1.3, 1.3, 0, 4, 1.4, 0, 0, 2.7, 1.3, 0, 1.3, 0, 1.3, 2.5, 2.5, 2.5, 2.5, 0, 1.3, 0, 0, 1.4, 1.4, 1.5, 1.5, 3.2),
                   "30_34"=c(4.6, 1.5, 3.1, 3.1, 3.1, 6.2, 4.6, 1.5, 3.1, 7.7, 4.6, 1.5, 4.6, 6.2, 1.5, 5.2, 1.3, 2.6, 2.6, 3.9, 7.8, 1.3, 0, 1.3, 1.3, 2.3, 6.8, 2.3, 1.2, 6.1, 1.3, 1.3, 0, 1.3, 9, 0, 0, 1.3, 6.6, 8, 4.1, 0, 1.4, 5.4, 1.3, 2.6, 2.5, 0, 7.3, 1.2, 3.6, 3.6, 3.7, 3.8, 1.3, 2.7, 0),
                   "35_39"=c(1.5, 0, 1.5, 4.6, 0, 3.1, 4.6, 3.1, 4.6, 1.5, 4.6, 1.5, 6.2, 3.1, 9.3, 8.2, 6.5, 6.5, 3.3, 4.9, 6.5, 8.2, 3.3, 13.1, 4.9, 5, 4.9, 13, 11.7, 5.8, 4.7, 3.5, 9.7, 11.1, 3.7, 6.3, 6.4, 7.7, 3.8, 11.5, 7.6, 5.1, 7.7, 7.8, 3.9, 8, 17.3, 8, 7.8, 5.1, 11.3, 8.7, 6.2, 2.4, 9.7, 8.5, 6.1),
                   "40_44"=c(0, 6.6, 5, 6.6, 5, 5, 6.6, 11.6, 6.6, 14.9, 16.6, 9.9, 8.3, 6.6, 14.9, 3.2, 9.6, 11.2, 6.4, 14.4, 11.2, 8, 11.2, 12.8, 11.2, 14.6, 20.7, 7.8, 11.8, 18.4, 9.1, 14, 9.9, 12.1, 13.2, 10.7, 13, 12.1, 16, 13.6, 7.6, 11.4, 12.7, 10.2, 16.5, 11.3, 11.2, 15.1, 12.6, 14, 19.6, 23.8, 9.2, 14.4, 14.2, 20.2, 21.2),
                   "45_49"=c(24.8, 6.8, 13.5, 9, 11.3, 9, 13.5, 15.8, 20.3, 15.8, 18, 20.3, 15.8, 15.8, 15.8, 14.8, 11.5, 29.6, 19.7, 21.4, 18.1, 23, 26.3, 26.3, 26.3, 22.4, 17.5, 25.1, 22.4, 34.3, 35.8, 25, 32.7, 30.4, 27.2, 28.8, 35.9, 24.2, 30.9, 30.3, 32.6, 43, 29.3, 28.4, 28.8, 25.4, 33, 35.4, 25.1, 30.1, 32.4, 26.3, 35.3, 28, 36.2, 33, 21.3),
                   "50_54"=c(40.1, 21.9, 40.1, 25.5, 51, 25.5, 36.4, 32.8, 47.4, 29.1, 29.1, 40.1, 29.1, 51, 69.2, 25.3, 34.3, 28.9, 47, 36.1, 41.6, 43.4, 39.8, 38, 45.2, 37.3, 54.3, 58, 63.6, 37.6, 56.2, 52.5, 51.9, 59.7, 69.4, 55.5, 52.5, 90.1, 75.2, 51.3, 74.9, 62.8, 37.9, 58.3, 54.9, 62, 62.4, 67.3, 68.7, 103.9, 114.4, 87.9, 72, 82.3, 55.2, 61.1, 59.8),
                   "55_59"=c(26.7, 48, 37.3, 40, 42.7, 37.3, 42.7, 53.3, 53.3, 53.3, 29.3, 42.7, 37.3, 29.3, 40, 58.1, 30.3, 50.6, 30.3, 50.6, 55.6, 58.1, 75.8, 58.1, 75.8, 57.2, 76, 94.9, 60.2, 89.9, 78, 109.1, 121, 102.5, 91.7, 113.3, 109.3, 115.3, 119.1, 116.2, 113.5, 106.6, 107.1, 119.7, 133.7, 118.3, 107.2, 105.5, 141.4, 181.6, 140.6, 116, 101.1, 99, 85.7, 104, 90.9),
                   "60_64"=c(54.6, 44.2, 41.6, 36.4, 49.4, 31.2, 78, 75.4, 57.2, 59.8, 59.8, 93.6, 109.2, 80.6, 67.6, 125.4, 90.8, 73.5, 99.4, 90.8, 164.3, 129.7, 108.1, 159.9, 159.9, 108.8, 96.5, 109.9, 125.9, 167.7, 168.6, 164.9, 121.7, 188.1, 163.4, 162.2, 191.3, 227.1, 168.3, 188.1, 194.5, 200.7, 183.5, 212.4, 175.6, 186.9, 201.9, 192.1, 244.3, 283.4, 249.8, 226.3, 192.9, 189.3, 169.4, 172.1, 148.1),
                   "65_69"=c(43.4, 46.7, 40.1, 66.8, 80.1, 70.1, 106.8, 103.5, 70.1, 113.5, 86.8, 100.1, 93.5, 76.8, 130.2, 175.5, 165.2, 158.3, 144.5, 147.9, 144.5, 120.4, 147.9, 106.7, 75.7, 161, 181.1, 209.2, 191.4, 132.6, 214.8, 221.1, 206.9, 253, 235.5, 267.4, 245.2, 268.4, 231.5, 293.6, 320.6, 377.9, 315.3, 354.3, 308.2, 281.5, 293.5, 324.2, 434.5, 423.6, 373.6, 270.9, 234.5, 242.5, 196.1, 214.4, 208.5),
                   "70_74"=c(40, 45, 75, 75, 60, 100, 140, 115, 85, 154.9, 149.9, 179.9, 149.9, 100, 120, 115.3, 155.1, 202.8, 194.8, 151.1, 190.8, 155.1, 198.8, 226.6, 214.7, 251, 262.7, 249.8, 252.3, 256.9, 285.5, 332.8, 350.2, 227.5, 279.2, 302.8, 352.5, 375.1, 420.7, 310.3, 365.2, 342.8, 418.9, 403.7, 366.4, 413.5, 444.2, 438, 392.4, 410, 448.7, 395.8, 320.6, 346.7, 394.8, 436, 304.7),
                   "75_79"=c(93, 82.7, 175.7, 134.4, 103.4, 155, 124, 144.7, 217.1, 175.7, 113.7, 175.7, 196.4, 217.1, 320.4, 146.1, 186, 252.4, 219.2, 225.8, 219.2, 199.3, 225.8, 285.6, 285.6, 260.6, 335.9, 296, 334.6, 389.5, 309.1, 430.5, 377.2, 487.2, 414, 365.3, 398.1, 427.9, 395.5, 422.7, 416, 409.6, 564.2, 494, 475.7, 519.6, 500.2, 509.2, 526.5, 518.4, 486.7, 581.6, 432.4, 444.6, 390.9, 400.5, 336.9),
                   "80+"=c(113.5, 136.2, 56.8, 102.2, 124.9, 124.9, 113.5, 79.5, 147.6, 45.4, 90.8, 193, 90.8, 113.5, 170.3, 92.2, 115.2, 138.3, 146, 138.3, 238.2, 184.4, 153.6, 199.7, 146, 290.8, 282.8, 272.1, 291.3, 323.3, 315.7, 326.1, 412.7, 349.3, 421, 412.5, 393.8, 443.8, 454.1, 567.6, 428.6, 596.2, 543.6, 436.9, 415.4, 565.4, 547.4, 559.6, 554.4, 476.2, 458, 494.4, 506.6, 504.9, 417.5, 451.4, 511.9))



e <- ggplot(data %>% pivot_longer(cols = c("X0_04",
"X05_09",
"X10_14",
"X15_19",
"X20_24",
"X25_29",
"X30_34",
"X35_39",
"X40_44",
"X45_49",
"X50_54",
"X55_59",
"X60_64",
"X65_69",
"X70_74",
"X75_79",
"X80."), names_to="starostna_skupina", values_to="inc_stopnja"), aes(x=Leto, y=starostna_skupina, fill=inc_stopnja)) +
    geom_tile() +
    theme_minimal() +
    scale_fill_gradient(low = "white", high = "blue",
                           limits=c(0,600)) +
    scale_y_discrete(labels=c("X0_04"= "0-04",
"X05_09"="05-09",
"X10_14"="10-14",
"X15_19"="15-19",
"X20_24"="20-24",
"X25_29"="25-29",
"X30_34"="30-34",
"X35_39"="35-39",
"X40_44"="40-44",
"X45_49"="45-49",
"X50_54"="50-54",
"X55_59"="55-59",
"X60_64"="60-64",
"X65_69"="65-69",
"X70_74"="70-74",
"X75_79"="75-79",
"X80."="80+")) +
    labs(y="Starostna skupina",
         fill="Groba incidenčna\nstopnja",
         title="Groba incidenčna stopnja v Sloveniji za izbrane rake",
         subtitle="Za moške")+
    theme(panel.grid.major.x = element_blank(),
          panel.grid.major.y = element_blank())
```


```{r, echo=FALSE, eval=TRUE, results="markup", fig.align="center", fig.width=16, fig.height=6}

data <- data.frame("Leto"=1961:2017,
                   "0_04"=c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
                   "05_09"=c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
                   "10_14"=c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1.6, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2.2, 0, 2.3, 0, 0, 2.2, 0),
                   "15_19"=c(0, 0, 0, 0, 0, 1.3, 0, 1.3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1.4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 4.1, 0, 0, 0, 2.2, 2.2),
                   "20_24"=c(0, 0, 2.8, 0, 1.4, 1.4, 1.4, 0, 0, 1.4, 0, 1.4, 2.8, 0, 1.4, 0, 1.3, 0, 0, 0, 0, 0, 2.7, 0, 1.3, 0, 1.3, 0, 0, 0, 0, 1.4, 0, 1.4, 0, 0, 0, 0, 0, 0, 2.7, 1.4, 0, 0, 1.5, 0, 0, 0, 1.6, 1.6, 0, 0, 1.8, 0, 0, 2, 0),
                   "25_29"=c(0, 0, 1.7, 0, 0, 1.7, 1.7, 0, 1.7, 1.7, 0, 0, 1.7, 1.7, 3.5, 0, 0, 1.3, 1.3, 0, 0, 2.5, 1.3, 1.3, 0, 0, 2.5, 5.1, 2.6, 2.6, 2.5, 0, 2.6, 1.3, 1.4, 0, 1.4, 0, 2.9, 4.3, 0, 1.4, 2.8, 0, 1.3, 0, 1.4, 0, 2.8, 0, 0, 3, 0, 0, 1.6, 0, 0),
                   "30_34"=c(0, 1.7, 6.6, 3.3, 3.3, 3.3, 3.3, 1.7, 3.3, 1.7, 0, 1.7, 3.3, 0, 5, 2.8, 0, 1.4, 5.6, 1.4, 4.2, 7, 2.8, 4.2, 5.6, 4.9, 2.4, 1.2, 6.3, 1.3, 1.3, 7.8, 5.2, 0, 1.3, 2.6, 3.9, 1.3, 2.6, 2.7, 2.8, 1.4, 0, 0, 1.4, 1.4, 4.1, 2.7, 5.4, 1.3, 1.3, 1.3, 0, 4.2, 4.3, 5.9, 6),
                   "35_39"=c(3.2, 4.7, 1.6, 3.2, 0, 4.7, 4.7, 12.6, 0, 3.2, 1.6, 1.6, 6.3, 1.6, 4.7, 3.5, 6.9, 6.9, 8.7, 0, 6.9, 5.2, 15.6, 5.2, 3.5, 1.3, 6.6, 3.8, 5, 9.9, 6.2, 2.5, 6.3, 10.2, 2.6, 5.2, 9.2, 5.3, 6.6, 3.9, 2.6, 6.5, 3.9, 9.2, 2.7, 5.6, 2.8, 11.4, 9.9, 7, 8.2, 1.4, 9.5, 10.7, 5.3, 2.7, 9.5),
                   "40_44"=c(1.5, 3.1, 3.1, 12.4, 20.1, 3.1, 12.4, 7.7, 7.7, 3.1, 4.6, 10.8, 6.2, 9.3, 17, 18.4, 18.4, 5, 18.4, 5, 13.4, 11.7, 8.4, 11.7, 16.7, 8.5, 6.7, 14.8, 7.8, 6, 13.7, 12.1, 9.1, 19.2, 12.9, 10.2, 19.1, 15.4, 9, 6.5, 17, 13.2, 7.9, 10.5, 14.4, 9.1, 7.8, 19.5, 14.5, 12.1, 15.2, 28.2, 18.5, 8.5, 9.9, 11, 13.6),
                   "45_49"=c(14.8, 8.2, 9.8, 6.6, 8.2, 11.5, 4.9, 13.1, 19.7, 11.5, 16.4, 16.4, 14.8, 21.3, 14.8, 9.7, 17.7, 14.5, 25.8, 21, 19.4, 12.9, 12.9, 8.1, 14.5, 13.2, 24.7, 19.4, 14.8, 15.1, 17.4, 15.4, 30.5, 21.5, 22.1, 21.8, 18.5, 23.3, 17.4, 30.1, 13, 18, 24.5, 25.9, 11.8, 34.2, 14.6, 19.8, 17.1, 15.7, 37.6, 20.7, 26.1, 17.2, 13.5, 20.9, 29.7),
                   "50_54"=c(27.5, 49.5, 35.7, 24.7, 30.2, 35.7, 22, 30.2, 16.5, 8.2, 11, 30.2, 27.5, 66, 24.7, 25.7, 25.7, 25.7, 27.3, 19.2, 28.9, 32.1, 38.5, 25.7, 30.5, 29.2, 37.8, 33.6, 30.8, 29, 34.1, 47.5, 48.5, 39.6, 54.6, 47.5, 41.4, 48.2, 38.4, 40.1, 44.4, 43.2, 40.2, 54.1, 38.5, 39.5, 42.9, 48.4, 48.5, 71.4, 73, 53.3, 35.9, 43.8, 44.9, 43.3, 49.7),
                   "55_59"=c(14.9, 36.2, 14.9, 29.8, 31.9, 51.1, 29.8, 46.8, 31.9, 40.4, 53.2, 23.4, 21.3, 17, 29.8, 22.5, 38.1, 46.8, 43.3, 26, 31.2, 41.6, 38.1, 60.6, 46.8, 53.8, 58.4, 59.6, 35.8, 54.2, 63.9, 51, 76.6, 49.2, 65.6, 39, 83.3, 61.2, 62.2, 84.8, 58.1, 47.9, 89.1, 72.9, 49.1, 76.8, 79.3, 80.6, 81.4, 113.4, 81.6, 57, 57.2, 45.3, 47.1, 56.7, 37.9),
                   "60_64"=c(31.3, 31.3, 41.7, 31.3, 64.7, 54.3, 31.3, 48, 35.5, 58.4, 56.4, 60.5, 45.9, 56.4, 79.3, 83.1, 74.2, 68.2, 26.7, 80.1, 80.1, 89, 139.4, 92, 109.8, 58.6, 77.6, 75.2, 92.4, 77.9, 75.2, 84.9, 104.6, 88.2, 99, 91, 94.3, 122.2, 84.6, 99.4, 99.1, 96.8, 107.8, 106.6, 103.9, 111.7, 126.6, 108.5, 93.1, 144.4, 95.8, 105.4, 90.1, 90.9, 76.5, 82.7, 74.8),
                   "65_69"=c(32.1, 39.5, 49.4, 54.4, 66.7, 74.1, 54.4, 76.6, 69.2, 79.1, 69.2, 64.3, 79.1, 93.9, 98.9, 79.9, 87.1, 92, 87.1, 116.2, 113.8, 65.4, 70.2, 94.4, 101.7, 118.9, 112.2, 101.9, 74.6, 100.8, 127.9, 130.2, 119.6, 139.5, 115.5, 130.3, 126.6, 147.5, 135.4, 127.1, 135.3, 149.4, 145.1, 161.8, 134.5, 133.8, 146.2, 171.9, 188.3, 175.5, 178.2, 155.2, 122.4, 106.1, 113.5, 117.4, 89.3),
                   "70_74"=c(78.9, 69.5, 37.9, 44.2, 75.8, 63.2, 91.6, 60, 101, 107.4, 72.6, 107.4, 101, 132.6, 129.5, 107, 130.5, 114.8, 135.7, 140.9, 130.5, 151.3, 164.4, 135.7, 148.7, 150.6, 125.1, 116.9, 137.6, 180.9, 178.8, 169.7, 152.1, 189.4, 157.5, 153.5, 183.4, 129.8, 159.7, 180.2, 191.5, 178.1, 180.2, 188.1, 168.8, 161.8, 248.9, 186.2, 174.6, 192.4, 176.6, 171.4, 146.9, 162.8, 204.9, 238.4, 160.4),
                   "75_79"=c(26.5, 63.7, 74.3, 63.7, 100.8, 53.1, 74.3, 84.9, 84.9, 74.3, 116.7, 143.3, 122, 169.8, 148.6, 133.8, 130.1, 189.6, 115.2, 204.4, 137.5, 152.4, 145, 174.7, 159.8, 161.9, 175.5, 202.6, 172.4, 179, 153.2, 225.6, 181.2, 205.2, 217.9, 208.3, 219, 234.5, 191.1, 217.2, 220.1, 245.1, 203.3, 241.6, 249.7, 246.9, 199, 253.6, 266.4, 250.3, 222.3, 224.6, 205.2, 232.5, 171.9, 185.9, 179.7),
                   "80+"=c(28, 28, 21, 49, 70, 70, 70, 112, 91, 77, 119, 98, 112, 98, 119, 81.8, 128.6, 109.1, 124.7, 101.3, 148.1, 140.3, 159.8, 116.9, 136.4, 182.3, 159.8, 177.2, 215.3, 224.1, 215.9, 213.1, 251.4, 216, 209.4, 297.9, 279.1, 249.1, 250.5, 274.7, 270.3, 302.2, 264.1, 285.5, 304.8, 250.5, 302.3, 264, 264.7, 261.4, 230.5, 237.5, 247.6, 242, 266.5, 233.5, 213.6))



f <- ggplot(data %>% pivot_longer(cols = c("X0_04",
"X05_09",
"X10_14",
"X15_19",
"X20_24",
"X25_29",
"X30_34",
"X35_39",
"X40_44",
"X45_49",
"X50_54",
"X55_59",
"X60_64",
"X65_69",
"X70_74",
"X75_79",
"X80."), names_to="starostna_skupina", values_to="inc_stopnja"), aes(x=Leto, y=starostna_skupina, fill=inc_stopnja)) +
    geom_tile() +
    theme_minimal() +
    scale_fill_gradient(low = "white", high = "red",
                           limits=c(0,600)) +
    scale_y_discrete(labels=c("X0_04"= "0-04",
"X05_09"="05-09",
"X10_14"="10-14",
"X15_19"="15-19",
"X20_24"="20-24",
"X25_29"="25-29",
"X30_34"="30-34",
"X35_39"="35-39",
"X40_44"="40-44",
"X45_49"="45-49",
"X50_54"="50-54",
"X55_59"="55-59",
"X60_64"="60-64",
"X65_69"="65-69",
"X70_74"="70-74",
"X75_79"="75-79",
"X80."="80+")) +
    labs(y="Starostna skupina",
         fill="Groba incidenčna\nstopnja",
         title="Groba incidenčna stopnja v Sloveniji za izbrane rake",
         subtitle="Za ženske")+
    theme(panel.grid.major.x = element_blank(),
          panel.grid.major.y = element_blank())

grid.arrange(e, f, ncol=2)
```


<br/><br/>

```{r, echo=FALSE, eval=TRUE, results="markup", fig.align="center"}
data <- data.frame("upravna_enota"=c(
"Jesenice",
"Kranj",
"Radovljica",
"Škofja Loka",
"Tržič",
"Gornja Radgona",
"Lendava",
"Ljutomer",
"Murska Sobota",
"Lenart",
"Ormož",
"Ptuj",
"Slovenska Bistrica",
"Maribor",
"Pesnica",
"Ruše",
"Dravograd",
"Radlje ob Dravi",
"Ravne na Koroškem",
"Slovenj Gradec",
"Celje",
"Laško",
"Mozirje",
"Slovenske Konjice",
"Šentjur pri Celju",
"Šmarje pri Jelšah",
"Velenje",
"Žalec",
"Hrastnik",
"Trbovlje",
"Zagorje ob Savi",
"Brežice",
"Krško",
"Sevnica",
"Črnomelj",
"Kočevje",
"Metlika",
"Novo mesto",
"Ribnica",
"Trebnje",
"Domžale",
"Grosuplje",
"Kamnik",
"Litija",
"Ljubljana",
"Logatec",
"Vrhnika",
"Cerknica",
"Ilirska Bistrica",
"Postojna",
"Ajdovščina",
"Idrija",
"Nova Gorica",
"Tolmin",
"Izola",
"Koper",
"Piran",
"Sežana"),
                   "inc_stopnja"=c(82.4,
63.6,
51.8,
61.9,
60.8,
100.1,
75.5,
79.8,
79.7,
67.4,
80.3,
77.4,
47.2,
75.8,
78.4,
89,
112.9,
56.9,
76.1,
70.8,
80.5,
57.7,
37.4,
51.2,
84.9,
87.2,
44.7,
56.7,
130.3,
55.7,
84.5,
29,
74.4,
55.2,
93.9,
41.6,
12,
73,
89.5,
61.6,
51.2,
56.6,
56.2,
71.1,
57.1,
50.3,
71.8,
89,
22.3,
49.4,
40.3,
61,
70.5,
70.6,
31.2,
47.4,
50.9,
51.5))


o <- ggplot(data, aes(x=reorder(upravna_enota, -inc_stopnja), y=inc_stopnja)) +
    geom_bar(stat="identity") +
    labs(x="Upravna enota",
         y="Groba incidenčna stopnja na 100.000",
         title="Groba incidenčna stopnja v Sloveniji za izbrane rake",
         subtitle="Za leto 2017 po upravnih enotah") +
    theme_minimal() +
    coord_flip()

```

```{r, echo=FALSE, eval=TRUE, results="markup", fig.align="center", fig.height=9, fig.width=13}

data$odstopanje <- round(data$inc_stopnja - mean(data$inc_stopnja))

data$odstopanje_above_below <- ifelse(data$odstopanje < 0, "Podpovprečno", "Nadpovprečno")

data <- data[order(data$odstopanje,decreasing = TRUE), ]

data$upravna_enota <- factor(data$upravna_enota, levels = data$upravna_enota)

p <- ggplot(data, aes(x=upravna_enota, y=odstopanje, label=odstopanje)) + 
    geom_point(stat='identity', aes(col=odstopanje_above_below), size=6)  +
    scale_color_manual(name=NULL, 
                       labels = c("Nadpovprečno", "Podpovprečno"), 
                       values = c("Nadpovprečno"="steelblue", "Podpovprečno"="orange")) + 
    geom_text(color="white", size=2.5) +
    coord_flip() +
    theme_minimal() +
    labs(y="Odstopanje grobe incidenčne stopnje na 100.000 od povprečja",
         x="Upravna enota",
         title="Prikaz odstopanja grobe incidenčne stopnje na 100.000 od povprečja",
         subtitle="za leto 2017")

grid.arrange(o, p, ncol=2)

```



# Umrljivost

Z umrljivostjo izrazimo absolutno število vseh umrlih za določeno boleznijo v točno določeni populaciji v enem koledarskem letu.

## Osnovni pogled

```{r, echo=FALSE, eval=TRUE, results="markup", fig.align="center"}
data <- data.frame("Leto"=1985:2017,
                   "umr_stopnja"=c(22.3, 20.7, 20.6, 23.1, 22.3, 24.2, 25.9, 26.9, 27.7, 26.5, 31.2, 30.1, 31.3, 30.2, 31.4, 29.9, 29.1, 33.4, 35.6, 33.6, 32.2, 33.9, 38.5, 37.5, 38.7, 38.5, 37.6, 36.8, 38.6, 35.8, 37.9, 37.8, 34))


i <- ggplot(data, aes(x=Leto, y=umr_stopnja)) +
    geom_line(size=1) +
    labs(x="Leto",
         y="Groba umrljivostna stopnja na 100.000",
         title="Groba umrljivostna stopnja v Sloveniji za izbrane rake") +
    theme_minimal() +
    ylim(c(0, 40))

```

```{r, echo=FALSE, eval=TRUE, results="markup", fig.align="center", fig.width=14, fig.height=7}
data <- data.frame("starostna_skupina"=c("0-04",
"05-09",
"10-14",
"15-19",
"20-24",
"25-29",
"30-34",
"35-39",
"40-44",
"45-49",
"50-54",
"55-59",
"60-64",
"65-69",
"70-74",
"75-79",
"80+"),
                   "umr_stopnja"=c(0,
0,
0,
0,
2,
0.8,
0.7,
1.3,
3.9,
6.2,
16.1,
24.2,
40.8,
60.6,
83.5,
145.4,
281))


j <- ggplot(data, aes(x=starostna_skupina, y=umr_stopnja)) +
    geom_bar(stat="identity") +
    labs(x="Starostna skupina",
         y="Groba umrljivostna stopnja na 100.000",
         title="Groba umrljivostna stopnja v Sloveniji za izbrane rake",
         subtitle="Za leto 2017 po starostnih skupinah") +
    theme_minimal()

grid.arrange(i, j, ncol=2)

```

```{r, echo=FALSE, eval=TRUE, results="markup", fig.align="center"}

# c("Debelo črevo (C18)", "rektum (C20)", "rektosigmoidna zveza (C19)")
# 
data <- data.frame("Leto"=1985:2017,
                   "debelo"=c(9.6, 9, 7.8, 10.6, 9.6, 10.3, 12.9, 12.8, 13.2, 12.8, 15.2, 16.1, 15.7, 15.5, 16.1, 16.4, 15.4, 18.5, 18, 17, 18, 19.1, 22.5, 21.8, 23.4, 22.7, 23.4, 22.9, 23.5, 21.1, 23, 22.7, 20.7),
                   "rektosig"=c(2, 1.4, 1.8, 1.6, 2.9, 2.7, 2.3, 2.6, 2.6, 2.3, 3.9, 3.3, 3.5, 3.6, 3.6, 2.5, 2.3, 3.6, 3.1, 4.1, 2.6, 3.3, 3.5, 3, 2.9, 2.9, 3, 2.6, 3.1, 3.1, 2.3, 2.8, 2.7),
                   "rektum"=c(10.7, 10.3, 10.9, 10.9, 9.9, 11.2, 10.7, 11.5, 11.9, 11.4, 12.1, 10.6, 12, 11, 11.7, 11, 11.4, 11.4, 14.5, 12.5, 11.6, 11.6, 12.5, 12.8, 12.4, 12.9, 11.2, 11.3, 12, 11.7, 12.7, 12.3, 10.6))


ggplot(data %>% pivot_longer(cols = c("debelo", "rektosig", "rektum"), names_to="Rak", values_to="umr_stopnja"), aes(x=Leto, y=umr_stopnja, col=Rak)) +
    geom_line(stat="identity", size=1) +
    labs(x="Tip raka",
         y="Groba umrljivostna stopnja na 100.000",
         title="Groba umrljivostna stopnja v Sloveniji za izbrane rake",
         subtitle="Za leto 2017") +
    theme_minimal() + 
    scale_color_manual(labels = c("Debelo črevo (C18)", "rektosigmoidna zveza (C19)", "rektum (C20)"), values=c("red","green","blue"))+
    ylim(c(0, 25))

```

```{r, echo=FALSE, eval=TRUE, results="markup", fig.align="center"}
data <- data.frame("Leto"=1985:2017,
                   "Moški"=c(22, 20.8, 20.5, 26.1, 25, 24.7, 26.8, 27.6, 30.7, 27.2, 32.8, 32.5, 34.3, 34.6, 34.4, 33, 32.7, 38.8, 39.1, 38.4, 34.3, 38.6, 43.5, 39.9, 47, 44.1, 42.2, 41.2, 45.9, 41.1, 44.5, 42.4, 40.5),
                   "Ženske"=c(22.6, 20.6, 20.6, 20.2, 19.7, 23.8, 25.1, 26.2, 24.9, 25.9, 29.7, 27.8, 28.4, 26, 28.5, 26.9, 25.6, 28.2, 32.3, 29, 30.3, 29.3, 33.6, 35.2, 30.6, 33.1, 33, 32.5, 31.5, 30.6, 31.4, 33.4, 27.6))


k <- ggplot(data %>% pivot_longer(cols = c("Moški", "Ženske"), names_to="Spol", values_to="umr_stopnja"), aes(x=Leto, y=umr_stopnja)) +
    geom_line(aes(color = Spol), size=1) +
    scale_color_manual(name="Spol", 
                       labels = c("Moški", "Ženske"), 
                       values = c("Moški"="skyblue", "Ženske"="tomato")) +
    labs(x="Leto",
         y="Groba umrljivostna stopnja na 100.000",
         title="Groba umrljivostna stopnja v Sloveniji za izbrane rake",
         subtitle="Glede na spol") +
    theme_minimal() +
    ylim(c(0,55))

```

```{r, echo=FALSE, eval=TRUE, results="markup", fig.align="center", fig.height=8}

data <- data.frame("starostna_skupina"=c("0-04",
"05-09",
"10-14",
"15-19",
"20-24",
"25-29",
"30-34",
"35-39",
"40-44",
"45-49",
"50-54",
"55-59",
"60-64",
"65-69",
"70-74",
"75-79",
"80+"),
                   "Moški"=c(0,
0,
0,
0,
1.9,
1.6,
1.4,
1.2,
5,
5.3,
20.4,
25.4,
65.2,
86.7,
116.8,
226.7,
435.8),
                   "Ženske"=c(0,
0,
0,
0,
2,
0,
0,
1.4,
2.7,
7.1,
11.8,
23,
16.3,
36,
56.2,
86.5,
208.1))


brks <- seq(-500, 500, 100)
lbls = c(seq(500, 0, -100), seq(100, 500, 100))


ggplot(data %>% pivot_longer(cols = c("Moški", "Ženske"), names_to="Spol", values_to="inc_stopnja") %>%
    mutate(multiplier = if_else(Spol == "Moški", -1, 1, 0)) %>%
    mutate(inc_stopnja = inc_stopnja*multiplier), 
    aes(x =inc_stopnja, y = starostna_skupina, fill = Spol)) +   # Fill column
    geom_bar(stat = "identity", width = .6) +   # draw the bars
    scale_x_continuous(breaks = brks,   # Breaks
                       labels = lbls) + # Labels
    scale_fill_manual(name="Spol", 
                       labels = c("Moški", "Ženske"), 
                       values = c("Moški"="skyblue", "Ženske"="tomato"))+
    labs(title="Groba umrljivostna stopnja v Sloveniji po spolu",
         subtitle="Za leto 2017",
         x="Groba umrljivostna stopnja na 100.000",
         y="Starostna skupina") +
    theme_minimal()



```


```{r, echo=FALSE, eval=TRUE, results="markup", fig.align="center", fig.width=14, fig.height=7}
data <- data.frame("Leto"=1985:2017,
                   "Moški"=c(35.5, 34.5, 35.2, 43.2, 39.5, 40, 44, 43.6, 48.2, 41, 49.7, 47.9, 50, 48.8, 46.9, 46.5, 44.3, 51.2, 49.5, 47, 40.6, 45, 49.7, 43.8, 51.2, 46.6, 43.4, 41.2, 44, 38.8, 40.7, 37.4, 34.8),
                   "Ženske"=c(25.1, 22.3, 21.9, 21.8, 20.7, 24.4, 25, 26.6, 24.3, 25, 28.6, 25.8, 25.8, 23.6, 25.3, 23.4, 21.5, 22.9, 25.7, 22.5, 22.8, 22, 24.1, 24.8, 21, 22.3, 21.8, 21.4, 20.3, 19, 19.6, 20.1, 16.1))


l <- ggplot(data %>% pivot_longer(cols = c("Moški", "Ženske"), names_to="Spol", values_to="inc_stopnja"), aes(x=Leto, y=inc_stopnja)) +
    geom_line(aes(color = Spol), size=1)  +
    scale_color_manual(name="Spol", 
                       labels = c("Moški", "Ženske"), 
                       values = c("Moški"="skyblue", "Ženske"="tomato")) +
    labs(x="Leto",
         y="Starostno standardizirana umrljivostna stopnja na 100.000",
         title="Starostno standardizirana umrljivostna stopnja v Sloveniji za izbrane rake",
         subtitle="Slovenski standard") +
    theme_minimal() +
    ylim(c(0,55))

grid.arrange(k, l, ncol=2)

```


## Dodatna vizualizacija

```{r, echo=FALSE, eval=TRUE, results="markup", fig.align="center"}

data <- data.frame("Leto"=1985:2017,
                   "0_04"=c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
                   "05_09"=c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
                   "10_14"=c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.8, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
                   "15_19"=c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.8, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
                   "20_24"=c(0.7, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.7, 0, 0, 0.7, 0, 0, 0.7, 0, 0.7, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.9, 0, 0, 0, 2),
                   "25_29"=c(0, 0, 0, 0.6, 2.6, 0, 1.9, 0.6, 0.7, 0, 0, 1.4, 0, 0, 0, 0, 0.7, 0, 0, 0, 0, 2.6, 0.6, 0, 0.7, 0.7, 0, 1.4, 0.7, 0, 0.8, 0, 0.8),
                   "30_34"=c(0.7, 0.6, 2.3, 0, 1.9, 1.2, 1.9, 0.6, 1.9, 0.7, 0.6, 1.3, 0, 1.3, 1.3, 2, 2.1, 0, 0.7, 0, 0, 0, 0.7, 0, 0, 1.3, 0.6, 0.6, 0, 0.7, 1.4, 1.4, 0.7),
                   "35_39"=c(5, 1.9, 0.6, 1.8, 6, 1.8, 1.8, 2.4, 1.2, 1.3, 3.8, 4.5, 1.3, 3.2, 1.9, 2.6, 0.6, 1.9, 3.2, 3.3, 0.7, 0.7, 1.4, 2.1, 1.4, 2.7, 4.6, 2, 3.9, 0, 1.9, 1.3, 1.3),
                   "40_44"=c(5.7, 9.1, 3.3, 4, 10.6, 9.4, 4, 3.9, 5.7, 4.3, 5, 5.6, 2.5, 3.7, 5, 2.5, 4.5, 4.5, 1.9, 3.9, 1.3, 3.2, 1.9, 1.9, 3.9, 3.3, 4.7, 5.5, 6.1, 6.1, 6.7, 5.3, 3.9),
                   "45_49"=c(6.5, 8.9, 9.7, 8.8, 7.3, 9.9, 11.2, 8.4, 10.8, 11.4, 10.8, 14.8, 6.9, 9.2, 13.5, 5, 7.5, 4.3, 10, 9.5, 4.5, 10.3, 5.8, 7.8, 5.1, 7, 6.4, 6.4, 10.3, 7.8, 11.2, 6.8, 6.2),
                   "50_54"=c(20.4, 11.6, 18.4, 29.6, 17.1, 23.9, 20.5, 18.6, 13.4, 28.9, 32.7, 24.8, 33.4, 29.3, 22.5, 23.7, 16.6, 18.9, 23.5, 22.3, 10.9, 14.7, 17, 23.6, 19.2, 16.8, 15.7, 12.5, 20.9, 18.3, 17.6, 12.9, 16.1),
                   "55_59"=c(45.2, 33.4, 28.6, 31.7, 37, 26.9, 37.1, 40.8, 40.5, 34.4, 37.3, 41.7, 52.5, 37.6, 38, 31.3, 36.4, 35.6, 38.5, 36.5, 39.2, 35.8, 33.3, 37.6, 37.1, 31.8, 30.9, 30.5, 34.2, 21.1, 30, 27.5, 24.2),
                   "60_64"=c(75.7, 58.6, 33, 57.1, 54.3, 55.3, 65.9, 72.1, 70.5, 59.3, 67.3, 67.5, 70, 65.2, 68.3, 52.3, 65.5, 62.2, 53.6, 55.7, 54.1, 51.2, 71.6, 58.7, 66.2, 53.8, 49.2, 44, 56.8, 51.7, 49.3, 43.4, 40.8),
                   "65_69"=c(62.5, 67.6, 86.1, 100.7, 80.4, 91.3, 79.8, 82.7, 101.3, 107.9, 114.2, 105.4, 106.2, 102.1, 107.9, 95.9, 71, 114.7, 107.5, 90.7, 113.7, 119.9, 104.5, 95.5, 91.2, 79.4, 76.1, 85.8, 73.8, 70.6, 70.1, 70, 60.6),
                   "70_74"=c(130.7, 139.3, 132.4, 137, 115.4, 125.5, 137.2, 140.9, 134.3, 130.5, 150, 127.8, 133.3, 135.2, 139.6, 139.3, 123.7, 139.1, 156.1, 156.3, 143.2, 118.3, 161.9, 146.8, 150.6, 164.5, 138.6, 127, 111.5, 133.8, 126.8, 119.9, 83.5),
                   "75_79"=c(195.4, 180.6, 177.9, 194.1, 173.6, 197.7, 184.4, 216.9, 224.1, 159.8, 238.1, 173.8, 192.5, 196.1, 187.6, 193.1, 186.4, 194.2, 233.8, 191.6, 168.8, 201.8, 232.8, 187.5, 206.4, 222.7, 218.8, 211.2, 200.7, 152.7, 169.7, 160.6, 145.4),
                   "80+"=c(204.3, 186.5, 230.4, 202.8, 210.5, 264.6, 319.3, 292.3, 286.6, 264.7, 302, 320.9, 331, 292.9, 311.6, 320, 302.8, 339.7, 308.9, 285.8, 275.5, 270.3, 301.2, 316.8, 317.4, 299, 298.3, 285.5, 296.4, 281.9, 286.3, 313.8, 281))



ggplot(data %>% pivot_longer(cols = c("X0_04",
"X05_09",
"X10_14",
"X15_19",
"X20_24",
"X25_29",
"X30_34",
"X35_39",
"X40_44",
"X45_49",
"X50_54",
"X55_59",
"X60_64",
"X65_69",
"X70_74",
"X75_79",
"X80."), names_to="starostna_skupina", values_to="inc_stopnja"), aes(x=Leto, y=starostna_skupina, fill=inc_stopnja)) +
    geom_tile() +
    theme_minimal() +
    scale_fill_gradient(low = "white", high = "black",limits=c(0,570)) +
    scale_y_discrete(labels=c("X0_04"= "0-04",
"X05_09"="05-09",
"X10_14"="10-14",
"X15_19"="15-19",
"X20_24"="20-24",
"X25_29"="25-29",
"X30_34"="30-34",
"X35_39"="35-39",
"X40_44"="40-44",
"X45_49"="45-49",
"X50_54"="50-54",
"X55_59"="55-59",
"X60_64"="60-64",
"X65_69"="65-69",
"X70_74"="70-74",
"X75_79"="75-79",
"X80."="80+")) +
    labs(y="Starostna skupina",
         fill="Groba umrljivostna\nstopnja",
         title="Groba umrljivostna stopnja po starostnih skupinah v času")+
    theme(panel.grid.major.x = element_blank(),
          panel.grid.major.y = element_blank())
```


```{r, echo=FALSE, eval=TRUE, results="markup", fig.align="center"}

data <- data.frame("Leto"=1985:2017,
                   "0_04"=c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
                   "05_09"=c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
                   "10_14"=c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
                   "15_19"=c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1.5, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
                   "20_24"=c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1.4, 0, 0, 1.3, 0, 0, 1.3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1.9),
                   "25_29"=c(0, 0, 0, 0, 2.6, 0, 0, 0, 1.3, 0, 0, 2.7, 0, 0, 0, 0, 1.3, 0, 0, 0, 0, 3.8, 1.2, 0, 1.3, 0, 0, 1.4, 0, 0, 1.5, 0, 1.6),
                   "30_34"=c(0, 0, 1.1, 0, 1.2, 1.2, 1.3, 1.3, 2.6, 1.3, 1.3, 1.3, 0, 1.3, 2.6, 2.7, 2.7, 0, 0, 0, 0, 0, 0, 0, 0, 1.2, 1.2, 0, 0, 1.3, 1.3, 0, 1.4),
                   "35_39"=c(4.9, 3.8, 1.2, 3.6, 7, 2.3, 2.3, 2.3, 1.2, 2.5, 3.7, 6.3, 1.3, 5.1, 0, 2.5, 1.3, 2.5, 3.8, 1.3, 0, 1.3, 1.3, 2.7, 0, 1.3, 7.5, 1.2, 6.2, 0, 1.2, 2.4, 1.2),
                   "40_44"=c(3.2, 9.7, 3.2, 3.1, 10.4, 14.1, 3.9, 2.5, 6.2, 3.6, 6, 9.5, 1.2, 6.1, 4.9, 1.2, 5, 2.5, 2.5, 6.4, 2.5, 3.8, 3.7, 1.3, 2.5, 2.5, 2.6, 6.6, 4, 6.5, 10.3, 3.8, 5),
                   "45_49"=c(9.9, 6.4, 12.7, 9.4, 11.2, 11.4, 13.6, 8.3, 14.7, 6.4, 12.1, 12.3, 8, 8.9, 19.7, 4.8, 7.2, 6, 13.4, 11.1, 6.3, 15.2, 10.1, 6.3, 6.3, 8.8, 8.7, 5, 10.1, 7.6, 10.3, 6.6, 5.3),
                   "50_54"=c(28.9, 15.3, 23.7, 34.1, 17.2, 30.8, 25.6, 18.6, 16.8, 34.8, 33.8, 24, 43.4, 35.3, 30.8, 24.9, 22.6, 23.2, 24.8, 22.8, 12.5, 17.4, 24.5, 26.2, 22.5, 21.5, 16.7, 16.8, 27, 25.7, 28.2, 14, 20.4),
                   "55_59"=c(60.7, 40.1, 33.4, 45.6, 54.8, 34.9, 46.4, 48.1, 55.9, 44.7, 52.4, 52, 75.9, 47.6, 57.7, 43.1, 43.1, 45.7, 49.8, 44.7, 52.2, 45.8, 34.3, 52, 48.9, 40.2, 41.3, 39.5, 45.4, 23.5, 46.1, 37.3, 25.4),
                   "60_64"=c(77.8, 72.5, 37.5, 92, 83.1, 64.3, 86.4, 102.3, 90.8, 71.6, 91, 81.1, 99.8, 93.8, 93.5, 69.5, 93.2, 102.4, 80.9, 81.8, 74.7, 63, 99.9, 71.3, 91.6, 81.7, 60.1, 50.4, 80.4, 66.4, 65.3, 62, 65.2),
                   "65_69"=c(61.9, 73.2, 120.8, 148.3, 118.3, 129.2, 115.6, 116.9, 161.9, 156.3, 160.6, 153.9, 137.3, 152.3, 148, 131.3, 117.2, 163, 162.3, 151.5, 153, 180.2, 131.2, 130.6, 154.1, 97.6, 119.9, 127.6, 128.1, 110.8, 83.8, 102, 86.7),
                   "70_74"=c(159, 188.2, 200.9, 207.1, 161.2, 166.7, 235.9, 174.6, 211.1, 166.3, 194.6, 204.6, 191.9, 245.1, 210.3, 227.8, 170.2, 220.6, 216.8, 230.7, 208.9, 150.1, 263.7, 217.6, 238.1, 254.9, 190.8, 180.2, 166.5, 190.4, 192.3, 165.5, 116.8),
                   "75_79"=c(259, 243.2, 222, 273.7, 272.2, 284.9, 256.5, 274.6, 342.1, 238.6, 356.2, 297.4, 353, 322.6, 281.7, 324.2, 294, 299.3, 321.7, 298.3, 235.7, 312.6, 364.5, 260.3, 327.7, 377, 319.7, 304.7, 268.9, 228.9, 240.3, 203.4, 226.7),
                   "80+"=c(276.6, 273.7, 282.8, 312.1, 298.9, 323.3, 396.4, 460.8, 392, 369.5, 427.6, 447.5, 438.4, 372.5, 388, 471.7, 474.5, 567.1, 481.7, 430.4, 347.2, 448.8, 428.1, 434.7, 540.5, 411.9, 454, 430.7, 481.8, 414, 440, 466.7, 435.8))



m <- ggplot(data %>% pivot_longer(cols = c("X0_04",
"X05_09",
"X10_14",
"X15_19",
"X20_24",
"X25_29",
"X30_34",
"X35_39",
"X40_44",
"X45_49",
"X50_54",
"X55_59",
"X60_64",
"X65_69",
"X70_74",
"X75_79",
"X80."), names_to="starostna_skupina", values_to="inc_stopnja"), aes(x=Leto, y=starostna_skupina, fill=inc_stopnja)) +
    geom_tile() +
    theme_minimal() +
    scale_fill_gradient(low = "white", high = "blue",limits=c(0,570)) +
    scale_y_discrete(labels=c("X0_04"= "0-04",
"X05_09"="05-09",
"X10_14"="10-14",
"X15_19"="15-19",
"X20_24"="20-24",
"X25_29"="25-29",
"X30_34"="30-34",
"X35_39"="35-39",
"X40_44"="40-44",
"X45_49"="45-49",
"X50_54"="50-54",
"X55_59"="55-59",
"X60_64"="60-64",
"X65_69"="65-69",
"X70_74"="70-74",
"X75_79"="75-79",
"X80."="80+")) +
    labs(y="Starostna skupina",
         fill="Groba umrljivostna\nstopnja",
         title="Groba umrljivostna stopnja v Sloveniji za izbrane rake",
         subtitle="Za moške")+
    theme(panel.grid.major.x = element_blank(),
          panel.grid.major.y = element_blank())
```


```{r, echo=FALSE, eval=TRUE, results="markup", fig.align="center", fig.width=16, fig.height=6}

data <- data.frame("Leto"=1985:2017,
                   "0_04"=c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
                   "05_09"=c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
                   "10_14"=c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1.6, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
                   "15_19"=c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
                   "20_24"=c(1.3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1.4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1.8, 0, 0, 0, 2),
                   "25_29"=c(0, 0, 0, 1.3, 2.6, 0, 3.8, 1.3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1.4, 0, 0, 0, 1.4, 0, 1.5, 1.5, 0, 0, 0, 0),
                   "30_34"=c(1.4, 1.2, 3.6, 0, 2.5, 1.3, 2.6, 0, 1.3, 0, 0, 1.3, 0, 1.3, 0, 1.4, 1.4, 0, 1.4, 0, 0, 0, 1.4, 0, 0, 1.3, 0, 1.3, 0, 0, 1.4, 2.9, 0),
                   "35_39"=c(5.2, 0, 0, 0, 5, 1.2, 1.2, 2.5, 1.3, 0, 3.9, 2.6, 1.3, 1.3, 3.9, 2.6, 0, 1.3, 2.6, 5.3, 1.4, 0, 1.4, 1.4, 2.8, 4.2, 1.4, 2.7, 1.4, 0, 2.7, 0, 1.4),
                   "40_44"=c(8.4, 8.5, 3.3, 4.9, 11, 4.5, 4.1, 5.4, 5.2, 5.1, 3.9, 1.3, 3.8, 1.3, 5.2, 3.9, 3.9, 6.6, 1.3, 1.3, 0, 2.6, 0, 2.6, 5.3, 4, 6.9, 4.2, 8.5, 5.7, 2.8, 6.9, 2.7),
                   "45_49"=c(3.2, 11.6, 6.6, 8.1, 3.3, 8.4, 8.7, 8.5, 6.8, 16.6, 9.5, 17.4, 5.7, 9.6, 6.7, 5.2, 7.8, 2.6, 6.5, 7.8, 2.6, 5.3, 1.3, 9.2, 3.9, 5.2, 3.9, 7.8, 10.4, 7.9, 12.2, 7, 7.1),
                   "50_54"=c(12.8, 8.1, 13.2, 25.2, 17.1, 17.1, 15.3, 18.7, 10, 23.1, 31.7, 25.6, 23.4, 23.2, 14, 22.5, 10.4, 14.4, 22.2, 21.7, 9.3, 11.8, 9.1, 20.9, 15.7, 11.9, 14.6, 8, 14.6, 10.6, 6.6, 11.8, 11.8),
                   "55_59"=c(34.6, 27.7, 24.3, 19.3, 21.1, 19.7, 28.6, 34, 26.1, 24.6, 23, 31.9, 30.1, 28, 19, 19.8, 30, 25.8, 27.3, 28.5, 26.2, 25.6, 32.3, 22.6, 24.8, 23, 20.1, 21.2, 22.6, 18.7, 13.5, 17.5, 23),
                   "60_64"=c(74.2, 49.7, 30, 33.2, 33.1, 48.5, 49.6, 47.6, 54, 49.2, 47.8, 56, 44.5, 40.1, 46, 36.8, 40.4, 25.6, 28.8, 32, 35.2, 40.4, 45.4, 46.8, 42, 26.9, 38.6, 37.6, 33.4, 36.9, 33.4, 24.8, 16.3),
                   "65_69"=c(62.9, 64, 65.2, 72.4, 58.5, 69.2, 59.2, 62.3, 63.5, 76.2, 82.5, 70.6, 83.2, 64.7, 77.6, 69, 35.2, 76.6, 63, 40.4, 80.7, 68.8, 81.6, 65.4, 36.9, 63.6, 38, 49.1, 25.2, 34.1, 57.6, 40.2, 36),
                   "70_74"=c(112.2, 108.8, 90.7, 95, 89, 102.2, 82.5, 122.9, 93.8, 111.8, 126.9, 88.3, 102.1, 74.2, 98.3, 85, 93.7, 85.1, 115.6, 105.8, 98.2, 95.9, 88.3, 94.1, 84.2, 94.2, 97.5, 84.7, 67.5, 88.3, 73.8, 83, 56.2),
                   "75_79"=c(159.8, 145.7, 153.2, 149.6, 120.1, 150.7, 146.2, 186.7, 163.1, 120.1, 180, 114.4, 118.2, 138.3, 145.4, 134.5, 138.5, 145.6, 191.3, 137.4, 133, 139.4, 156, 144.6, 133.2, 128.5, 154.9, 150.5, 155, 100.3, 119.9, 129.9, 86.5),
                   "80+"=c(167.6, 150.1, 208.4, 157.1, 173.5, 239.9, 286.9, 222, 242.8, 221.5, 250.1, 269.5, 288, 261.6, 282.2, 262.7, 239, 257.5, 246.9, 234.8, 250.4, 207.4, 255.8, 273.3, 232.9, 254.6, 235.3, 225, 217.4, 224.4, 217.8, 243.4, 208.1))



n <- ggplot(data %>% pivot_longer(cols = c("X0_04",
"X05_09",
"X10_14",
"X15_19",
"X20_24",
"X25_29",
"X30_34",
"X35_39",
"X40_44",
"X45_49",
"X50_54",
"X55_59",
"X60_64",
"X65_69",
"X70_74",
"X75_79",
"X80."), names_to="starostna_skupina", values_to="inc_stopnja"), aes(x=Leto, y=starostna_skupina, fill=inc_stopnja)) +
    geom_tile() +
    theme_minimal() +
    scale_fill_gradient(low = "white", high = "red",limits=c(0,570)) +
    scale_y_discrete(labels=c("X0_04"= "0-04",
"X05_09"="05-09",
"X10_14"="10-14",
"X15_19"="15-19",
"X20_24"="20-24",
"X25_29"="25-29",
"X30_34"="30-34",
"X35_39"="35-39",
"X40_44"="40-44",
"X45_49"="45-49",
"X50_54"="50-54",
"X55_59"="55-59",
"X60_64"="60-64",
"X65_69"="65-69",
"X70_74"="70-74",
"X75_79"="75-79",
"X80."="80+")) +
    labs(y="Starostna skupina",
         fill="Groba umrljivostna\nstopnja",
         title="Groba umrljivostna stopnja v Sloveniji za izbrane rake",
         subtitle="Za ženske")+
    theme(panel.grid.major.x = element_blank(),
          panel.grid.major.y = element_blank())

grid.arrange(m,n,ncol=2)
```


```{r, echo=FALSE, eval=TRUE, results="markup", fig.align="center", fig.height=8}
data <- data.frame("upravna_enota"=c(
"Jesenice",
"Kranj",
"Radovljica",
"Škofja Loka",
"Tržič",
"Gornja Radgona",
"Lendava",
"Ljutomer",
"Murska Sobota",
"Lenart",
"Ormož",
"Ptuj",
"Slovenska Bistrica",
"Maribor",
"Pesnica",
"Ruše",
"Dravograd",
"Radlje ob Dravi",
"Ravne na Koroškem",
"Slovenj Gradec",
"Celje",
"Laško",
"Mozirje",
"Slovenske Konjice",
"Šentjur pri Celju",
"Šmarje pri Jelšah",
"Velenje",
"Žalec",
"Hrastnik",
"Trbovlje",
"Zagorje ob Savi",
"Brežice",
"Krško",
"Sevnica",
"Črnomelj",
"Kočevje",
"Metlika",
"Novo mesto",
"Ribnica",
"Trebnje",
"Domžale",
"Grosuplje",
"Kamnik",
"Litija",
"Ljubljana",
"Logatec",
"Vrhnika",
"Cerknica",
"Ilirska Bistrica",
"Postojna",
"Ajdovščina",
"Idrija",
"Nova Gorica",
"Tolmin",
"Izola",
"Koper",
"Piran",
"Sežana"),
                   "inc_stopnja"=c(360.2,
315.3,
370.3,
349.4,
238.5,
388.9,
308.1,
294.3,
362.2,
392.2,
383.5,
248.4,
303.6,
396.4,
240.9,
298.8,
352,
274.2,
277.2,
279.8,
320.7,
254.7,
292.8,
358.3,
544.9,
326,
306.5,
315.1,
314.8,
320.5,
392.2,
275.3,
279.7,
313.2,
322.5,
254.5,
228.9,
289.6,
246.3,
297.3,
201.2,
267.3,
372.4,
289.7,
359.6,
323.8,
371.5,
207.6,
327.6,
314.5,
302.5,
286.8,
316.5,
369.5,
356,
242.5,
260.4,
273.5))


r <- ggplot(data, aes(x=reorder(upravna_enota, -inc_stopnja), y=inc_stopnja)) +
    geom_bar(stat="identity") +
    labs(x="Upravna enota",
         y="Groba umrljivostna stopnja na 100.000",
         title="Groba umrljivostna stopnja v Sloveniji za izbrane rake",
         subtitle="Za leto 2017 po upravnih enotah") +
    theme_minimal() +
    coord_flip()

```


```{r, echo=FALSE, eval=TRUE, results="markup", fig.align="center", fig.height=8, fig.height=9, fig.width=13}

data$odstopanje <- round(data$inc_stopnja - mean(data$inc_stopnja))

data$odstopanje_above_below <- ifelse(data$odstopanje < 0, "Podpovprečno", "Nadpovprečno")

data <- data[order(data$odstopanje, decreasing = TRUE), ]

data$upravna_enota <- factor(data$upravna_enota, levels = data$upravna_enota)

s <- ggplot(data, aes(x=upravna_enota, y=odstopanje, label=odstopanje)) + 
    geom_point(stat='identity', aes(col=odstopanje_above_below), size=6)  +
    scale_color_manual(name=NULL, 
                       labels = c("Nadpovprečno", "Podpovprečno"), 
                       values = c("Nadpovprečno"="steelblue", "Podpovprečno"="orange")) + 
    geom_text(color="white", size=2.5) +
    coord_flip() +
    theme_minimal() +
    labs(y="Odstopanje grobe umrljivostne stopnje na 100.000 od povprečja",
         x="Upravna enota",
         title="Prikaz odstopanja grobe umrljivostne stopnje na 100.000 od povprečja",
         subtitle="za leto 2017")

grid.arrange(r, s, ncol=2)

```



# Preživetje

Preživetje predstavlja delež bolnikov, ki so po izbranem obdobju od postavitve diagnoze še živi. Preživetje bolnikov z rakom običajno opazujemo po enem, treh, petih in desetih letih po diagnozi. V našem primeru si bomo ogledali relativno preživetje ki je razmerje med opazovanim in pričakovanim preživetjem, t.j. preživetjem, ki ga glede na spol in starost v določenem obdobju pričakujemo v celotni populaciji, iz katere prihajajo bolniki.

## Relativno preživetje
```{r, echo=FALSE, eval=TRUE, results="markup", fig.align="center"}

theme_set(theme_classic())

source_df <- data.frame("Moški"=c(50.4,
31.4,
28.3,
25.8),
"Ženske"=c(55.2,
35.1,
29.9,
28.6),
"year"=c(1, 3, 5, 10)) %>%
    pivot_longer(cols = c("Moški", "Ženske"), values_to="value", names_to="group")


# Define functions. Source: https://github.com/jkeirstead/r-slopegraph
tufte_sort <- function(df, x="year", y="value", group="group", method="tufte", min.space=0.05) {
    ## First rename the columns for consistency
    ids <- match(c(x, y, group), names(df))
    df <- df[,ids]
    names(df) <- c("x", "y", "group")

    ## Expand grid to ensure every combination has a defined value
    tmp <- expand.grid(x=unique(df$x), group=unique(df$group))
    tmp <- merge(df, tmp, all.y=TRUE)
    df <- mutate(tmp, y=ifelse(is.na(y), 0, y))
  
    ## Cast into a matrix shape and arrange by first column
    require(reshape2)
    tmp <- dcast(df, group ~ x, value.var="y")
    ord <- order(tmp[,2])
    tmp <- tmp[ord,]
    
    min.space <- min.space*diff(range(tmp[,-1]))
    yshift <- numeric(nrow(tmp))
    ## Start at "bottom" row
    ## Repeat for rest of the rows until you hit the top
    for (i in 2:nrow(tmp)) {
        ## Shift subsequent row up by equal space so gap between
        ## two entries is >= minimum
        mat <- as.matrix(tmp[(i-1):i, -1])
        d.min <- min(diff(mat))
        yshift[i] <- ifelse(d.min < min.space, min.space - d.min, 0)
    }

    
    tmp <- cbind(tmp, yshift=cumsum(yshift))

    scale <- 1
    tmp <- melt(tmp, id=c("group", "yshift"), variable.name="x", value.name="y")
    ## Store these gaps in a separate variable so that they can be scaled ypos = a*yshift + y

    tmp <- transform(tmp, ypos=y + scale*yshift)
    return(tmp)
   
}

plot_slopegraph <- function(df) {
    ylabs <- subset(df, x==head(x,1))$group
    yvals <- subset(df, x==head(x,1))$ypos
    fontSize <- 4
    gg <- ggplot(df,aes(x=x,y=ypos)) +
        geom_line(aes(group=group, color=group), size=1) +
        geom_point(colour="white",size=8) +
        geom_text(aes(label=y), size=fontSize, family="American Typewriter") +
        scale_y_continuous(name="", breaks=yvals, labels=ylabs, limits=c(0,80))
        scale_color_manual(name=NULL, 
                           labels = c("Moški", "Ženske"), 
                           values = c("Moški"="skyblue", "Ženske"="tomato"))
    return(gg)
}    

## Prepare data    
df <- tufte_sort(source_df, 
                 x="year", 
                 y="value", 
                 group="group", 
                 method="tufte", 
                 min.space=0.05)

df <- transform(df, 
                x=factor(x, levels=c(1,3,5,10), 
                            labels=c("1 leto","3 leta","5 let","10 let")), 
                y=round(y))

## Plot
t <- plot_slopegraph(df) + labs(subtitle="Leto 1985") + 
                      theme(axis.title=element_blank(),
                            axis.ticks = element_blank(),
                            plot.title = element_text(hjust=0.5,
                                                      family = "American Typewriter",
                                                      face="bold"),
                            axis.text = element_text(family = "American Typewriter",
                                                     face="bold"),
                            legend.position = "none")

```


```{r, echo=FALSE, eval=TRUE, results="markup", fig.align="center"}

theme_set(theme_classic())

source_df <- data.frame("Ženske"=c(67,
46.2,
38.7,
33.7),
"Moški"=c(68.6,
46.8,
36.9,
31.3),
"year"=c(1, 3, 5, 10)) %>%
    pivot_longer(cols = c("Moški", "Ženske"), values_to="value", names_to="group")


# Define functions. Source: https://github.com/jkeirstead/r-slopegraph
tufte_sort <- function(df, x="year", y="value", group="group", method="tufte", min.space=0.05) {
    ## First rename the columns for consistency
    ids <- match(c(x, y, group), names(df))
    df <- df[,ids]
    names(df) <- c("x", "y", "group")

    ## Expand grid to ensure every combination has a defined value
    tmp <- expand.grid(x=unique(df$x), group=unique(df$group))
    tmp <- merge(df, tmp, all.y=TRUE)
    df <- mutate(tmp, y=ifelse(is.na(y), 0, y))
  
    ## Cast into a matrix shape and arrange by first column
    require(reshape2)
    tmp <- dcast(df, group ~ x, value.var="y")
    ord <- order(tmp[,2])
    tmp <- tmp[ord,]
    
    min.space <- min.space*diff(range(tmp[,-1]))
    yshift <- numeric(nrow(tmp))
    ## Start at "bottom" row
    ## Repeat for rest of the rows until you hit the top
    for (i in 2:nrow(tmp)) {
        ## Shift subsequent row up by equal space so gap between
        ## two entries is >= minimum
        mat <- as.matrix(tmp[(i-1):i, -1])
        d.min <- min(diff(mat))
        yshift[i] <- ifelse(d.min < min.space, min.space - d.min, 0)
    }

    
    tmp <- cbind(tmp, yshift=cumsum(yshift))

    scale <- 1
    tmp <- melt(tmp, id=c("group", "yshift"), variable.name="x", value.name="y")
    ## Store these gaps in a separate variable so that they can be scaled ypos = a*yshift + y

    tmp <- transform(tmp, ypos=y + scale*yshift)
    return(tmp)
   
}

plot_slopegraph <- function(df) {
    ylabs <- subset(df, x==head(x,1))$group
    yvals <- subset(df, x==head(x,1))$ypos
    fontSize <- 4
    gg <- ggplot(df,aes(x=x,y=ypos)) +
        geom_line(aes(group=group, color=group), size=1) +
        geom_point(colour="white",size=8) +
        geom_text(aes(label=y), size=fontSize, family="American Typewriter") +
        scale_y_continuous(name="", breaks=yvals, labels=ylabs, limits=c(0,80)) +
        scale_color_manual(name=NULL, 
                           labels = c("Moški", "Ženske"), 
                           values = c("Moški"="skyblue", "Ženske"="tomato"))
    return(gg)
}    

## Prepare data    
df <- tufte_sort(source_df, 
                 x="year", 
                 y="value", 
                 group="group", 
                 method="tufte", 
                 min.space=0.05)

df <- transform(df, 
                x=factor(x, levels=c(1,3,5,10), 
                            labels=c("1 leto","3 leta","5 let","10 let")), 
                y=round(y))

## Plot
u <- plot_slopegraph(df) + labs(subtitle = "Leto 1995") + 
                      theme(axis.title=element_blank(),
                            axis.ticks = element_blank(),
                            plot.title = element_text(hjust=0.5,
                                                      family = "American Typewriter",
                                                      face="bold"),
                            axis.text = element_text(family = "American Typewriter",
                                                     face="bold"),
                            legend.position = "none")

```

```{r, echo=FALSE, eval=TRUE, results="markup", fig.align="center", fig.height=6, fig.width=10}

theme_set(theme_classic())

source_df <- data.frame("Moški"=c(76.3,
61.4,
53.1,
42.1),
"Ženske"=c(72.9,
56,
50,
43.5),
"year"=c(1, 3, 5, 10)) %>%
    pivot_longer(cols = c("Moški", "Ženske"), values_to="value", names_to="group")


# Define functions. Source: https://github.com/jkeirstead/r-slopegraph
tufte_sort <- function(df, x="year", y="value", group="group", method="tufte", min.space=0.05) {
    ## First rename the columns for consistency
    ids <- match(c(x, y, group), names(df))
    df <- df[,ids]
    names(df) <- c("x", "y", "group")

    ## Expand grid to ensure every combination has a defined value
    tmp <- expand.grid(x=unique(df$x), group=unique(df$group))
    tmp <- merge(df, tmp, all.y=TRUE)
    df <- mutate(tmp, y=ifelse(is.na(y), 0, y))
  
    ## Cast into a matrix shape and arrange by first column
    require(reshape2)
    tmp <- dcast(df, group ~ x, value.var="y")
    ord <- order(tmp[,2])
    tmp <- tmp[ord,]
    
    min.space <- min.space*diff(range(tmp[,-1]))
    yshift <- numeric(nrow(tmp))
    ## Start at "bottom" row
    ## Repeat for rest of the rows until you hit the top
    for (i in 2:nrow(tmp)) {
        ## Shift subsequent row up by equal space so gap between
        ## two entries is >= minimum
        mat <- as.matrix(tmp[(i-1):i, -1])
        d.min <- min(diff(mat))
        yshift[i] <- ifelse(d.min < min.space, min.space - d.min, 0)
    }

    
    tmp <- cbind(tmp, yshift=cumsum(yshift))

    scale <- 1
    tmp <- melt(tmp, id=c("group", "yshift"), variable.name="x", value.name="y")
    ## Store these gaps in a separate variable so that they can be scaled ypos = a*yshift + y

    tmp <- transform(tmp, ypos=y + scale*yshift)
    return(tmp)
   
}

plot_slopegraph <- function(df) {
    ylabs <- subset(df, x==head(x,1))$group
    yvals <- subset(df, x==head(x,1))$ypos
    fontSize <- 4
    gg <- ggplot(df,aes(x=x,y=ypos)) +
        geom_line(aes(group=group, color=group), size=1) +
        geom_point(colour="white",size=8) +
        geom_text(aes(label=y), size=fontSize, family="American Typewriter") +
        scale_y_continuous(name="", breaks=yvals, labels=ylabs, limits=c(0,80)) +
        scale_color_manual(name=NULL, 
                           labels = c("Moški", "Ženske"), 
                           values = c("Moški"="skyblue", "Ženske"="tomato"))
    return(gg)
}    

## Prepare data    
df <- tufte_sort(source_df, 
                 x="year", 
                 y="value", 
                 group="group", 
                 method="tufte", 
                 min.space=0.05)

df <- transform(df, 
                x=factor(x, levels=c(1,3,5,10), 
                            labels=c("1 leto","3 leta","5 let","10 let")), 
                y=round(y))

## Plot
v <- plot_slopegraph(df) + labs(subtitle="Leto 2005") + 
                      theme(axis.title=element_blank(),
                            axis.ticks = element_blank(),
                            plot.title = element_text(hjust=0.5,
                                                      family = "American Typewriter",
                                                      face="bold"),
                            axis.text = element_text(family = "American Typewriter",
                                                     face="bold"),
                            legend.position = "none")

grid.arrange(t, u, v, ncol=3)

```
